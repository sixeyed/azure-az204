# Securing Apps with Key Vault and Virtual Networks - AZ-204 Exam Focus

## Exam Relevance

This lab covers several critical areas of the AZ-204: Developing Solutions for Microsoft Azure exam. Let's break down exactly which exam objectives this lab addresses and why these skills matter for the certification.

## Objective Domain: Implement Azure Security

### Implement Secure Cloud Solutions

**Managing Secrets with Azure Key Vault**

The AZ-204 exam expects you to understand how to use Azure Key Vault to manage application secrets, keys, and certificates. In this lab, you've practiced:

- Creating an Azure Key Vault using the Azure CLI
- Storing sensitive connection strings as secrets
- Retrieving secrets programmatically from applications
- Understanding when and why to use Key Vault versus app settings or environment variables

Key exam concepts:
- Key Vault is the preferred method for storing sensitive configuration data
- Secrets in Key Vault are versioned and audited
- Key Vault supports soft-delete and purge protection for additional security
- You should be able to write code that retrieves secrets from Key Vault using the Azure SDK

**Implementing Managed Identities**

Managed identities are a critical topic on the AZ-204 exam. The exam will test your understanding of:

- The difference between system-assigned and user-assigned managed identities
- How to enable managed identity for Azure services like App Service, Function Apps, and VMs
- How to grant managed identities access to other Azure resources
- How managed identities eliminate the need to store credentials in code

In this lab, we:
- Enabled a system-assigned managed identity for App Service
- Granted the managed identity permission to read secrets from Key Vault
- Saw firsthand how the application uses this identity automatically without any credentials in the code

This is a common exam scenario: "Your application needs to access Azure Key Vault. What is the most secure way to authenticate?" The answer involves managed identities.

## Objective Domain: Develop for Azure Storage

**Configure Azure Storage Accounts for Security**

The exam covers storage account security in depth. You need to know:

- How to configure network rules and firewalls for storage accounts
- How to use service endpoints to allow VNet access
- How to use shared access signatures versus managed identities
- When to use different authentication methods for Blob Storage

The lab challenge specifically addresses this by asking you to secure the Storage Account using network rules, just like we did with Key Vault.

**Working with Blob Storage**

You need to understand:
- How applications connect to Blob Storage using connection strings or managed identities
- The structure of storage account connection strings
- How to configure applications to use Blob Storage
- Best practices for storing connection strings (hint: Key Vault!)

## Objective Domain: Implement Azure App Service Web Apps

**Configure Web App Settings**

The exam tests your knowledge of:
- How to configure app settings for web apps
- The difference between app settings and connection strings
- How app settings are accessed in code
- Using Key Vault references in app settings

In this lab, we configured app settings to:
- Specify which database API to use (BlobStorage)
- Enable Key Vault integration
- Specify which Key Vault to connect to

**Implement VNet Integration for App Service**

This is a critical exam topic that many candidates struggle with. You must understand:

- That App Service apps don't run inside VNets by default
- How to use VNet integration to allow outbound calls to VNet resources
- The difference between VNet integration and App Service Environment (ASE)
- Why you would use VNet integration (to access restricted resources like private databases, Key Vaults, or on-premises resources)

The exam might present scenarios like: "Your web app needs to access an Azure SQL Database that is configured with a private endpoint. What should you configure?" The answer involves VNet integration.

## Objective Domain: Monitor, Troubleshoot, and Optimize Azure Solutions

**Application Insights and Logging**

While not the primary focus of this lab, we did use logging to troubleshoot issues:

- Accessing Kudu tools for App Service
- Using log streams to view real-time application logs
- Interpreting error messages to diagnose configuration issues

The exam expects you to know how to:
- Enable and configure Application Insights
- Use log streams and Kudu tools
- Diagnose common issues with App Service applications
- Understand error messages from Azure services

## Common Exam Question Patterns

Based on this lab's content, here are types of questions you might see on the exam:

**Scenario-Based Questions:**
"Your company has a web application that needs to access secrets from Key Vault. The security team requires that Key Vault should not be accessible from the internet. The application is deployed to Azure App Service. What should you configure?"

Answer approach:
1. Enable VNet integration for the App Service
2. Configure Key Vault network rules to allow the subnet
3. Set Key Vault default action to Deny
4. Enable managed identity for the App Service
5. Grant the managed identity access to Key Vault secrets

**Troubleshooting Questions:**
"You have configured a web app to use managed identity to access Key Vault. The web app returns a 403 Forbidden error when trying to access a secret. What could be the cause?"

Possible causes based on our lab:
1. The managed identity doesn't have the correct permissions in Key Vault
2. Key Vault has network restrictions and the app isn't accessing it through an allowed network path
3. The Key Vault access policy hasn't been configured for the managed identity

**Best Practices Questions:**
"What is the most secure way to provide a web application access to an Azure Storage Account connection string?"

Answer:
1. Store the connection string in Azure Key Vault
2. Use managed identity to access Key Vault from the application
3. Better yet, use managed identity to access Storage directly without a connection string

## Hands-On Skills for the Exam

While the AZ-204 is primarily a multiple-choice exam, Microsoft is incorporating more hands-on elements. You should be comfortable with:

- Writing Azure CLI commands for all the services in this lab
- Understanding the equivalent Azure PowerShell and Azure Portal operations
- Reading and understanding application code that uses Azure SDK for .NET, Java, Python, or JavaScript
- Interpreting ARM templates and Bicep files that deploy these resources

## Key Takeaways for Exam Success

1. **Security First**: Always prefer managed identities over connection strings or keys
2. **Network Isolation**: Understand how to use VNets, service endpoints, and private endpoints
3. **Configuration Management**: Know when to use Key Vault, app settings, and environment variables
4. **Troubleshooting**: Be able to diagnose common issues with authentication and network connectivity
5. **CLI Proficiency**: Practice Azure CLI commands for all major operations

## Related Exam Topics to Study

After completing this lab, you should also study:

- Private Endpoints vs Service Endpoints (we used Service Endpoints in this lab)
- Azure Functions integration with VNets and managed identities
- Azure Container Instances and Azure Kubernetes Service networking
- Azure SQL Database firewall rules and VNet integration
- Service-to-service authentication patterns in Azure

## Practice Recommendations

To reinforce these exam topics:

1. Rebuild this lab from memory without looking at the instructions
2. Try using managed identity to access Storage Account directly instead of using a connection string
3. Implement the same architecture using Azure PowerShell instead of Azure CLI
4. Create an ARM template or Bicep file that deploys this entire solution
5. Add Application Insights to the web app and explore the telemetry
6. Configure private endpoints instead of service endpoints and understand the differences

Remember, the AZ-204 exam tests both theoretical knowledge and practical understanding. The hands-on experience you've gained in this lab will help you recognize correct answers and understand why other options are incorrect.

Good luck with your exam preparation!
