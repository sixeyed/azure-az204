# Application Gateway - AZ-204 Exam Focus

Application Gateway is covered in the AZ-204 exam under the implement Azure security domain, specifically relating to implementing secure cloud solutions. Understanding Application Gateway and Web Application Firewall is essential for the exam as they represent Azure's application-layer traffic management and security capabilities.

## Layer 7 Load Balancing

For the exam, understand that Application Gateway operates at layer 7 of the OSI model, the application layer, which is different from Azure Load Balancer that operates at layer 4. Layer 7 load balancing means routing decisions are based on HTTP request attributes like host headers, URL paths, cookies, and query strings. This enables more intelligent routing compared to network-level load balancing.

## Application Gateway Components

You need to know the key components of Application Gateway. Frontend IP configuration is the public or private IP address that clients connect to and can be public, private, or both. Listeners define how the gateway listens for incoming traffic, and multi-site listeners can host multiple websites on a single gateway by matching different host headers. Backend pools are collections of backend resources like virtual machines, virtual machine scale sets, IP addresses, or FQDNs, and the gateway distributes traffic across healthy members. Routing rules connect listeners to backend pools, defining how requests are forwarded with options for basic or path-based routing. Health probes continuously monitor backend resources to ensure they're responding, automatically removing unhealthy backends from rotation. HTTP settings define how traffic is sent to backends, including protocol, port, cookie-based affinity, and connection draining.

## SKU Tiers

Application Gateway comes in different SKU tiers you should know for the exam. Standard_v2 provides basic load balancing and SSL termination without WAF. WAF_v2 includes Web Application Firewall capabilities in addition to all Standard features, which is what we used in our lab. The v2 SKUs support autoscaling, zone redundancy, and static VIPs, making them the recommended choice for production deployments.

## Web Application Firewall

WAF is a critical security feature you need to understand. OWASP Core Rule Set implements rules from the Open Web Application Security Project, with version 3.2 being the latest available. WAF modes include Detection Mode which logs threats but doesn't block them for testing and identifying false positives, and Prevention Mode which actively blocks detected threats for production use. Rule management allows you to disable specific rules if they cause false positives or create custom rules for specific needs.

## Routing Capabilities

For the exam, know these routing types. Basic routing sends all requests to a listener to a single backend pool with simple but less flexible configuration. Path-based routing sends different URL paths to different backend pools, enabling scenarios like routing /api to API backend pool and /images to image server pool. Multi-site routing sends different domain names or host headers to different backend pools, which is what we configured in the lab.

## Integration with Other Services

Understand how Application Gateway integrates with other Azure services. Azure Container Instances can be used as backend pool members as we demonstrated. Azure Kubernetes Service can use Application Gateway as an AKS ingress controller. API Management is commonly deployed behind Application Gateway for additional security. Virtual Machine Scale Sets can be configured as backend pools that automatically scale. These integration patterns appear frequently in exam scenarios.

## Monitoring and Diagnostics

For the exam, know these monitoring capabilities. Metrics include throughput, response time, failed requests, and healthy unhealthy host counts. Diagnostic logs provide three types - access logs with every request details, performance logs with metrics, and firewall logs with WAF detections and blocks. Backend health shows real-time health status of backend pool members through the Portal or API.

## Common Scenarios and Troubleshooting

The 502 Bad Gateway error is the most common issue with Application Gateway, typically meaning no routing rule matches the request, backend is unhealthy or unreachable, backend is timing out, or NSG or firewall is blocking traffic to backend. Performance optimization involves using connection draining when updating backends, configuring appropriate timeout values, and enabling HTTP/2 for better performance with modern clients. WAF tuning starts in Detection mode, monitors logs for false positives, then disables problematic rules or creates exceptions before enabling Prevention mode.

## Security Best Practices

For the exam, know these security recommendations. Always use WAF_v2 SKU for internet-facing applications. Enable Prevention mode in production after validating in Detection mode. Use managed identities for certificate management with Key Vault integration. Deploy Application Gateway in a dedicated subnet. Use Network Security Groups to restrict traffic to the Application Gateway subnet. Enable diagnostic logging for security auditing. These practices demonstrate security awareness that the exam tests.

## Practice Recommendations

Understanding these concepts at a practical level helps you succeed on Application Gateway questions. Focus on identifying the correct routing type for given scenarios, understanding when to use WAF_v2 versus Standard_v2, troubleshooting 502 errors and connectivity issues, configuring SSL termination and end-to-end SSL, choosing between Application Gateway and alternative services, and understanding WAF Detection versus Prevention modes. Hands-on experience like this lab builds the real knowledge that exam questions test.
