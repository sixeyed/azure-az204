# Kubernetes Services - AZ-204 Exam Focus

**Purpose:** Exam-focused narration covering AZ-204 requirements
**Target:** Candidates preparing for AZ-204 exam section on containerized solutions

---

## Introduction

If you're preparing for the AZ-204 exam, understanding Kubernetes Services is crucial for the containerized solutions portion of the test. Microsoft expects you to know how to configure networking for applications running in Azure Kubernetes Service, and Services are the foundation of Kubernetes networking.

In this session, we'll focus specifically on the concepts and patterns that show up on the exam. Let's make sure you're ready!

---

## AZ-204 Exam Objective: Configure Containerized Applications

The AZ-204 exam tests your ability to develop solutions using containers, specifically within the Azure ecosystem. When it comes to Kubernetes Services, you need to understand several key areas:

**First**, how to implement networking for containerized applications. This means understanding how Pods communicate within a cluster and how external clients access your services.

**Second**, how Azure Kubernetes Service integrates with other Azure networking services, particularly Azure Load Balancer.

**Third**, service discovery mechanisms and how applications find each other in a dynamic environment.

Let's break down each of these areas with exam-relevant details.

---

## Service Types: What You Must Know for the Exam

The exam will test your understanding of when to use each Service type. Let's be really clear about this.

### ClusterIP Services

ClusterIP is the default Service type and it's used for internal communication. When you see an exam scenario describing microservices that need to communicate within a cluster, ClusterIP is your answer.

Key exam points:
- ClusterIP provides an internal IP address accessible only within the cluster
- Perfect for backend services, databases, and internal APIs
- Supports load balancing across multiple Pods automatically
- DNS resolution works automatically for Services in the same namespace

On the exam, you might see questions about isolating backend services or ensuring internal-only communication. ClusterIP Services are the solution.

### NodePort Services

NodePort Services expose applications on a static port across all nodes in the cluster. While you'll see this on the exam, it's typically presented as a development or testing solution rather than production.

Key exam points:
- Exposes your Service on each node's IP at a static port, typically in the 30000-32767 range
- Any traffic to any node on that port gets routed to your Service
- Useful when you don't have a cloud load balancer available
- Not recommended for production on AKS because there are better options

Exam scenarios might ask you to troubleshoot connectivity or explain why a NodePort Service isn't the best choice for production workloads.

### LoadBalancer Services

This is the big one for AZ-204. LoadBalancer Services are how you expose applications publicly in Azure Kubernetes Service.

Key exam points:
- Automatically provisions an Azure Load Balancer when created in AKS
- Provides a public IP address managed by Azure
- Integrates with Azure networking features like network security groups
- Supports multiple services with different public IPs
- Can be configured with internal load balancers for private access

The exam loves scenarios about exposing web applications or APIs to the internet. When you see this in an AKS context, think LoadBalancer Service. You might also see questions about the costs associated with LoadBalancer Services - remember that each LoadBalancer Service creates an Azure Load Balancer resource, which has associated costs.

---

## Service Discovery and DNS

This is a critical concept for the exam. Kubernetes includes a built-in DNS server that automatically creates DNS records for every Service. Understanding this is essential.

Here's what you need to know:

**DNS Names**: Every Service gets a DNS name in the format `service-name.namespace.svc.cluster.local`. Within the same namespace, you can just use the Service name.

**Automatic Updates**: When Pods are created or destroyed, the Service automatically updates its endpoints. The DNS name and Service IP remain constant, but the backend Pods can change freely.

**Service Discovery Pattern**: Applications should always use Service DNS names, never Pod IPs. This is a best practice question that appears on exams.

Exam scenarios often involve troubleshooting connectivity issues. If an application can't find a backend service, check:
- Does the Service exist in the correct namespace?
- Does the Service selector match the Pod labels?
- Is the application using the correct DNS name?

---

## Label Selectors: The Routing Mechanism

Services use label selectors to find their target Pods. This is fundamental to how Kubernetes works and definitely appears on the exam.

Key concepts:

**Loose Coupling**: Services and Pods are independent. A Service uses labels to find Pods, which means you can update, scale, or replace Pods without modifying the Service.

**Label Syntax**: Labels are key-value pairs like `app=frontend` or `tier=api`. Services use selectors to match these labels.

**Dynamic Routing**: When you create a new Pod with matching labels, the Service automatically adds it to the rotation. When a Pod is deleted, it's automatically removed.

**Zero Matches**: A Service can exist even if no Pods match its selector. The Service will have no endpoints and traffic will fail until matching Pods are created.

**Multiple Matches**: When multiple Pods match, the Service load balances between them. This is the standard pattern for scaling applications.

Exam questions might ask: "Why isn't traffic reaching your Pods?" The answer often involves checking whether the Service selector matches the Pod labels.

---

## Integration with Azure Load Balancer

When you create a LoadBalancer Service in AKS, Azure automatically provisions infrastructure. Understanding this integration is important for the exam.

**What Happens Behind the Scenes:**

When you deploy a LoadBalancer Service, the AKS control plane communicates with Azure Resource Manager to create an Azure Load Balancer. This load balancer is provisioned in the node resource group, not your primary resource group.

**Public vs. Internal Load Balancers:**

By default, LoadBalancer Services create public load balancers with public IP addresses. However, you can create internal load balancers by adding an annotation to your Service definition. Internal load balancers are used when you want to expose services within a virtual network but not to the internet.

**IP Address Management:**

You can either let Azure assign a dynamic public IP, or you can specify a static IP that you've previously created. For production scenarios, static IPs are recommended because they don't change if you delete and recreate the Service.

**Network Security:**

LoadBalancer Services respect Azure network security groups. You can control traffic at the subnet level using NSGs, in addition to any network policies within Kubernetes.

Exam scenarios might ask you to design a solution for exposing microservices, some public and some private. The answer involves using LoadBalancer Services with appropriate annotations and network security configurations.

---

## Service Endpoints and Health Checks

Services maintain a list of endpoints - the IP addresses of Pods that match the selector. This is important for troubleshooting and understanding traffic flow.

**Endpoint Objects:**

When you create a Service, Kubernetes automatically creates an Endpoint object with the same name. This object lists all the Pod IPs that are currently receiving traffic.

**Readiness Probes:**

Only Pods that pass their readiness probes are added to Service endpoints. If a Pod fails its readiness check, it's automatically removed from the Service's load balancing pool.

**Health and Traffic:**

This means your Service automatically routes around unhealthy Pods. You don't need to do anything special - Kubernetes handles it automatically.

For the exam, remember: if traffic isn't reaching expected Pods, check the endpoints and verify the Pods are passing their readiness probes.

---

## Common Exam Scenarios

Let me walk you through some typical exam question patterns:

**Scenario 1: Microservices Communication**
"You have a frontend application that needs to communicate with a backend API, both running in AKS. How should you configure networking?"

Answer: Create a ClusterIP Service for the backend API. The frontend uses the Service DNS name to communicate. This provides load balancing and service discovery automatically.

**Scenario 2: Public Access**
"You need to expose a web application running in AKS to internet users. What's the recommended approach?"

Answer: Create a LoadBalancer Service. This provisions an Azure Load Balancer with a public IP address and handles all the traffic routing.

**Scenario 3: Troubleshooting Connectivity**
"An application in AKS can't reach a backend service. What should you check?"

Answer: Verify the Service exists, check that the Service selector matches the Pod labels, ensure the Pod is running and ready, check the Service endpoints to see if the Pod is included.

**Scenario 4: Scaling**
"You need to handle increased traffic to your application. How do you scale while maintaining the same endpoint?"

Answer: Scale the number of Pod replicas. The Service automatically load balances across all Pods with matching labels. Clients continue using the same Service DNS name.

**Scenario 5: Internal vs External Access**
"You have services that should only be accessible within the virtual network, and others that need internet access. How do you configure this in AKS?"

Answer: Use ClusterIP for internal-only services. For services needing external access within the VNet, use LoadBalancer Services with internal load balancer annotations. For internet-facing services, use standard LoadBalancer Services.

---

## Port Configuration Details

The exam sometimes includes specific questions about port configuration, so let's be precise:

**Service Port**: The port that the Service listens on within the cluster. This is what other Pods use to connect.

**Target Port**: The port on the Pod where traffic actually goes. This is the port your container is listening on.

**Node Port**: For NodePort Services, this is the port exposed on each node, typically in the 30000-32767 range.

**Container Port**: This is defined in the Pod specification, not the Service. It must match the targetPort in the Service.

A common exam question: "Traffic isn't reaching your application despite the Service existing. What might be wrong?" Often the answer involves a port mismatch between the Service targetPort and the container port.

---

## Best Practices for AZ-204

These best practices regularly appear in exam scenarios:

**Always use Services for Pod communication**, never rely on Pod IPs directly.

**Use meaningful Service names** that clearly indicate the service's purpose.

**Apply appropriate labels** to Pods so Services can select them correctly.

**Use readiness probes** to ensure only healthy Pods receive traffic.

**Choose the right Service type** - ClusterIP for internal, LoadBalancer for external on AKS.

**Consider costs** - each LoadBalancer Service creates an Azure Load Balancer, which has associated costs.

**Use namespaces** to organize services and implement network policies.

**Implement proper monitoring** of Service endpoints to detect issues quickly.

---

## Security Considerations

The exam expects you to understand security implications:

**Network Policies**: You can use Kubernetes Network Policies to control which Pods can communicate with which Services.

**Service Accounts**: Services run in a security context. Understand how service accounts work with Azure AD pod identity.

**TLS/SSL**: While Services themselves don't provide TLS termination, understand how to implement HTTPS using ingress controllers or application-level TLS.

**Azure Integration**: Services can integrate with Azure Private Link, virtual networks, and network security groups for additional security layers.

---

## Troubleshooting for the Exam

Exam questions often present broken scenarios. Here's your troubleshooting checklist:

**Can't resolve Service name?**
- Check if the Service exists in the expected namespace
- Verify DNS is working in the cluster
- Use the fully qualified name if accessing across namespaces

**Service exists but traffic fails?**
- Check Service endpoints - are there any?
- Verify Pod labels match Service selector
- Check if Pods are running and ready
- Verify port configuration matches

**LoadBalancer pending forever?**
- On AKS, this usually indicates a quota issue or configuration problem
- Check Azure resource provider registration
- Verify subnet has available IP addresses

**Traffic goes to wrong Pods?**
- Check label selectors - they might be too broad
- Verify Pod labels are correctly set

---

## Integration with Other Azure Services

The AZ-204 exam covers how AKS integrates with the broader Azure ecosystem:

**Azure Application Gateway**: Can be used as an ingress controller for AKS, providing advanced routing and Web Application Firewall capabilities.

**Azure Monitor**: Services can be monitored using Azure Monitor and Container Insights.

**Azure Key Vault**: While not directly related to Services, understand how Pods access secrets from Key Vault while communicating through Services.

**Azure Container Registry**: Your Pods pull images from ACR and communicate through Services.

**Azure Virtual Networks**: Services (especially LoadBalancer type) integrate with VNet for network isolation and security.

---

## Quick Reference for Exam Day

Here are the key facts to remember:

- **ClusterIP**: Internal only, default type, DNS automatically configured
- **NodePort**: Exposes on all nodes, specific port range, typically for dev/test
- **LoadBalancer**: Creates Azure Load Balancer, public or internal, production-ready
- **Label Selectors**: Services find Pods using labels, loose coupling
- **DNS**: Every Service gets automatic DNS entry, format is `name.namespace.svc.cluster.local`
- **Endpoints**: Automatically managed list of Pod IPs receiving traffic
- **Readiness**: Only ready Pods receive traffic through Services
- **Scaling**: Add more Pod replicas, Service automatically load balances
- **Costs**: Each LoadBalancer Service creates Azure resources with associated costs

---

## Conclusion

Kubernetes Services are a core component of the AZ-204 exam's containerization objectives. You need to understand not just how to create Services, but when to use each type, how they integrate with Azure, and how to troubleshoot common issues.

Focus on understanding the relationship between Services, Pods, labels, and endpoints. Know how DNS works for service discovery. Understand the Azure integration points, especially with Azure Load Balancer.

Practice creating Services in AKS, troubleshoot connectivity issues, and experiment with different configurations. The hands-on experience will make the exam questions much more intuitive.

Remember, the exam is testing whether you can design and implement real solutions. Understanding Services isn't just about memorizing facts - it's about knowing when and how to use them to solve actual business problems on Azure.

Good luck with your exam preparation!
