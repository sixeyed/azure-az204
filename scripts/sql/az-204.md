# Azure SQL - AZ-204 Exam Exercises

Azure SQL appears in the AZ-204 exam under the "Develop for Azure storage" and "Develop Azure compute solutions" domains. This is a critical topic because understanding when to use each Azure SQL option and how to properly configure security and connectivity is essential for the exam. These exercises focus specifically on the scenarios and decision-making patterns you'll encounter when choosing and implementing database solutions in Azure.

## Prerequisites

You should have completed the basic Azure SQL lab to understand the fundamental concepts of SQL Server logical servers, databases, and firewall rules. These exam-focused exercises assume you're comfortable with the basics and ready to explore the decision criteria and integration patterns that distinguish different SQL deployment options.

## AZ-204 Exam Skills Covered

The exam expects you to demonstrate competency across a wide range of Azure SQL capabilities. You need to understand when to use SQL Database versus SQL Managed Instance versus SQL Virtual Machines, with each option suited for different scenarios. Authentication methods including SQL authentication with username and password versus Azure AD authentication with multi-factor authentication support are critical exam topics. Network security through firewall rules is essential - understanding that Azure SQL has a default-deny firewall and knowing how to configure server-level rules for all databases, database-level rules for specific databases, and virtual network rules for network isolation. Resource hierarchy knowledge includes understanding that SQL Server is a logical container with no compute cost, databases inherit server-level authentication, and deleting a resource group cascades to all contained resources. Connection string formats for ADO.NET and other platforms are tested, along with best practices for storing them in Key Vault or App Service settings. Performance and scaling decisions between provisioned compute with predictable performance versus serverless compute that pauses when inactive are frequently tested. Finally, backup and recovery capabilities including automatic backups with weekly full backups, point-in-time restore to any moment within retention, and deleted database recovery are important exam topics.

## Understanding Azure SQL Service Options

The AZ-204 exam expects you to understand when to use each Azure SQL option, and this decision-making ability appears frequently in scenario-based questions.

SQL Database is the Platform-as-a-Service option best suited for new cloud-native applications, applications with variable or unpredictable workloads using the serverless tier, scenarios where you want automatic updates, backups, and high availability without management overhead, and multi-tenant SaaS applications using elastic pools. The key features to know for the exam are automatic backups with point-in-time restore up to 35 days, built-in high availability with 99.99% SLA, serverless compute tier for intermittent usage that automatically pauses and resumes, elastic pools for managing multiple databases with shared resources, and the limitation that you have no access to server-level features like SQL Agent or cross-database queries.

SQL Managed Instance is suited for migrating from on-premises SQL Server with minimal changes, scenarios needing near 100% compatibility with SQL Server features, applications that require SQL Server Agent for job scheduling, cross-database queries, or linked servers to other systems, and situations where you need instance-level features not available in SQL Database. The key features include VNet integration for network isolation, near-complete SQL Server feature parity including most features that don't exist in SQL Database, automated backups and updates just like SQL Database, and native Virtual Network support for private connectivity.

SQL Virtual Machines are appropriate when you need complete control over SQL Server configuration and settings, require OS-level access for custom software or configurations, are migrating applications with minimal changes and need exact SQL Server compatibility, or need features not available in PaaS options like CLR assemblies or FileStream. The key features are full SQL Server feature parity with every feature available in on-premises SQL Server, OS-level access and control for complete customization, the responsibility that you manage updates and backups manually, and IaaS pricing where you pay for the VM continuously.

A common exam question pattern is "An application requires SQL Server Agent to run nightly data processing jobs. The solution should minimize management overhead. What should you use?" The answer is SQL Managed Instance because it provides SQL Server Agent while still offering automatic patching and backups.

## Authentication and Security

Authentication is a major exam topic because secure database access is critical for production applications.

SQL Authentication uses username and password credentials stored in SQL Server. The credentials work across all network boundaries including from the internet, making it suitable for cloud scenarios. This is the default for Azure SQL and what we used in the basic lab with username "sqladmin" and a password. SQL Authentication is simple to configure and doesn't require additional identity infrastructure, but passwords must be managed and rotated manually.

Azure Active Directory Authentication integrates with Azure AD for centralized identity management. It supports multi-factor authentication for enhanced security, enables centralized identity and access management across all Azure services, and can use managed identities from your applications for passwordless authentication. This is the best practice for production applications because credentials are managed centrally and can use conditional access policies.

A common exam scenario is "An App Service needs to connect to Azure SQL. The solution must not store database credentials in the application. What should you do?" The answer is to enable a managed identity on the App Service, configure the SQL database for Azure AD authentication, grant the managed identity access to the database, and use the managed identity for authentication in the connection string.

## Network Security and Firewall Rules

Firewall rules are critical for the exam because they're required for any client to connect to Azure SQL.

You must understand that Azure SQL has a default-deny firewall. All client connections are blocked until you explicitly allow them through firewall rules. When a client tries to connect, they encounter an error message that clearly states "Client with IP address X.X.X.X is not allowed to access the server" and tells you to add it to the firewall rules.

Server-level firewall rules apply to all databases on the logical server. They can be configured in the portal using the Firewall settings or via CLI using az sql server firewall-rule create. You specify IP address ranges to allow, creating rules like "Allow Office Network" with a range of IP addresses. These are convenient when multiple databases need the same access rules.

Database-level firewall rules apply to specific databases only. They're configured using T-SQL commands like sp_set_database_firewall_rule, providing more granular control than server-level rules. You use these when different databases have different access requirements, such as a production database with restricted access and a development database with broader access.

Virtual Network rules allow access from specific Azure VNets, providing network isolation by keeping database traffic on the Azure backbone network. They're better security for production workloads because you're not opening access to public IP ranges but rather to your private network space. This requires configuring a service endpoint on the VNet subnet for Microsoft.Sql.

The exam frequently tests the firewall concept with scenarios like "Users report they cannot connect to the database from their office. What should you check first?" The answer is to verify that a firewall rule exists allowing the office's public IP address range.

## Resource Hierarchy and Management

Understanding the resource hierarchy is essential for managing costs and access control.

The hierarchy structure is Resource Group containing SQL Server, which is a logical container, containing one or more databases. The SQL Server logical server is not a VM but rather a management endpoint with a globally unique name that becomes your-server-name.database.windows.net. Crucially, the server has no compute cost by itself - you only pay for databases. Databases inherit server-level authentication, so admin credentials set at the server level work for all databases. Deleting a server deletes all its databases automatically through cascading delete. Deleting a resource group deletes everything inside including servers and databases.

Common exam questions test this hierarchy. "You delete an Azure SQL Database. What happens to the SQL Server?" The answer is that the SQL Server remains unchanged because databases are children of the server. "You delete the resource group containing a SQL Server. What happens to the databases?" The answer is that all databases are also deleted because resource group deletion cascades to all contained resources.

## CLI Commands for Exam

You should be comfortable with these Azure CLI commands because they appear in code-based questions.

Creating a SQL Server uses az sql server create with parameters for resource group, server name which must be globally unique, location, admin username with the -u flag, and admin password with the -p flag. The server name must contain only lowercase letters, numbers, and hyphens.

Creating a database uses az sql db create with parameters for resource group, server name with the -s flag, and database name with the -n flag. You can optionally specify the service tier and compute size.

Managing firewall rules uses az sql server firewall-rule create with parameters for resource group, server name, rule name to identify the rule, start-ip-address for the beginning of the range, and end-ip-address for the end of the range. For a single IP, use the same value for both start and end.

Deleting resources uses az sql db delete to remove a specific database, which keeps the server, and az sql server delete to remove the server and all its databases. The az group delete command removes the resource group and everything inside.

## Connection Strings

Understanding connection string format is important for the exam because you need to know how applications connect to databases.

The ADO.NET format is Server equals tcp colon your-server.database.windows.net comma 1433 semicolon Initial Catalog equals database-name semicolon User ID equals username semicolon Password equals password semicolon Encrypt equals True semicolon TrustServerCertificate equals False semicolon Connection Timeout equals 30 semicolon. The key components are the Server with fully qualified domain name and port 1433, Initial Catalog which is the database name, User ID and Password for SQL authentication credentials, Encrypt equals True to enforce SSL/TLS encryption, and Connection Timeout for how long to wait.

Best practices for connection strings in applications are critical for the exam. Store connection strings in Azure Key Vault for the most secure option with centralized secret management, use App Service Application Settings which can reference Key Vault secrets, leverage Azure App Configuration for centralized configuration management, or use environment variables for containerized applications. Never hardcode connection strings in source code because this exposes credentials and makes rotation difficult.

A common exam pattern is "An application's connection string contains database credentials. You need to improve security. What should you do?" The answer is to move the connection string to Key Vault, enable managed identity on the application, grant the identity access to Key Vault, and reference the secret using Key Vault reference syntax.

## Performance and Scaling

Understanding compute tiers and when to use each is frequently tested.

Provisioned compute means resources are always available with predictable performance, billed per hour for the capacity provisioned regardless of actual usage, and suitable for workloads with consistent, predictable resource needs. You choose a specific number of vCores or DTUs and pay for that capacity continuously.

Serverless compute automatically pauses when inactive to reduce costs, automatically resumes on demand when requests arrive, is billed per second for compute used only when active, and has minimum and maximum vCore settings to control cost and performance boundaries. This is perfect for development and test databases, applications with intermittent usage patterns, or workloads where usage is unpredictable.

The service tiers you must know are Basic for small workloads with 5 DTU max and 2GB storage, Standard for medium workloads up to 3000 DTUs suitable for most applications, Premium for high-performance up to 4000 DTUs with low latency, General Purpose for balanced price-performance with 2 to 80 vCores, Business Critical for low latency and high availability with 2 to 80 vCores and readable secondary replicas, and Hyperscale for very large databases up to 100TB with rapid scaling.

A typical exam scenario is "A database is used only during business hours 8 AM to 6 PM. How can you optimize costs?" The answer is to use serverless compute tier which automatically pauses outside business hours and you only pay for compute when active.

## Backup and Recovery

Backup and recovery capabilities are essential exam knowledge because they're critical for data protection.

Automatic backups run without any configuration needed. Full backups run weekly, differential backups run every 12 to 24 hours, and transaction log backups run every 5 to 10 minutes for point-in-time restore capability. The default retention is 7 days but can be extended to 35 days for short-term retention. Long-term retention is available up to 10 years for compliance requirements.

Point-in-time restore can restore to any point within the retention period, creates a new database rather than overwriting the existing one, can restore to a different server or region for disaster recovery, and works even for deleted databases within the retention period. This is critical for recovering from data corruption or accidental deletion.

A common exam question is "A database was accidentally deleted yesterday. Can you recover the data?" The answer is yes, if within the retention period which defaults to 7 days, using the restore feature to create a new database from the automatic backups.

## Cost Optimization

Understanding cost factors is important for designing cost-effective solutions.

The SQL Server itself has no cost because it's just a logical container for management purposes. Databases are charged based on the compute tier and size measured in vCores or DTUs, storage consumed with separate charges beyond the included amount, and backup storage beyond the included amount which equals database size.

Serverless compute provides pay-per-second billing for compute used only when the database is active, dramatically reducing costs for intermittent workloads. Reserved capacity offers significant discounts for 1 to 3 year commitments on provisioned compute, suitable for production workloads with predictable usage. Elastic pools allow multiple databases to share resources, reducing costs for multi-tenant applications where databases have different peak usage times.

## Common Exam Scenarios

The exam presents scenarios requiring you to choose the correct solution.

Scenario one: An application cannot connect to Azure SQL Database. The troubleshooting steps are to check firewall rules first because this is the most common issue, verify the connection string has the correct server name and database name, check credentials are correct for SQL authentication or Azure AD, and ensure the database exists and is not paused if using serverless.

Scenario two: Choosing the right Azure SQL option. For variable or intermittent workloads use serverless SQL Database, for lift-and-shift migrations with minimal changes use SQL Managed Instance or VM depending on management overhead tolerance, for applications needing SQL Agent or linked servers use Managed Instance, and for scenarios requiring complete control use SQL on VM.

Scenario three: Securing database access. Use Azure AD authentication for centralized identity management, implement VNet integration to keep traffic on private networks, use Private Link for private connectivity without public endpoint exposure, store credentials in Key Vault instead of application code, and enable Advanced Threat Protection for security monitoring and alerts.

Scenario four: Optimizing costs. Use serverless for development, test, or intermittent workloads, use elastic pools for multi-tenant applications with multiple databases, use reserved capacity for production workloads with predictable usage, and monitor actual usage to right-size databases based on real resource consumption.

## Cleanup

When you're finished with these exercises, removing the resource group deletes everything using az group delete. This removes the resource group and all resources within it - the SQL Server, all databases, and any other resources. This cleanup is important not just for cost management but also because the exam sometimes includes questions about proper resource lifecycle management and understanding the cascade effects of resource deletion.
