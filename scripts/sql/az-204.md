# Azure SQL - AZ-204 Exam Focus

## Key Concepts for the AZ-204 Exam

This module covers several important concepts that appear on the AZ-204: Developing Solutions for Microsoft Azure exam. Let's focus on what you need to know.

## Understanding Azure SQL Service Options

The AZ-204 exam expects you to understand when to use each Azure SQL option:

### 1. SQL Database (PaaS)

**When to use**:
- New cloud-native applications
- Applications with variable or unpredictable workloads (use serverless tier)
- When you want automatic updates, backups, and high availability
- Multi-tenant SaaS applications (using elastic pools)

**Key features to know**:
- Automatic backups with point-in-time restore
- Built-in high availability (99.99% SLA)
- Serverless compute tier for intermittent usage
- Elastic pools for managing multiple databases
- No access to server-level features

### 2. SQL Managed Instance

**When to use**:
- Migrating from on-premises SQL Server
- Need near 100% compatibility with SQL Server
- Require SQL Server Agent, cross-database queries, or linked servers
- Need instance-level features

**Key features to know**:
- VNet integration for network isolation
- Near-complete SQL Server feature parity
- Automated backups and updates
- Native Virtual Network support

### 3. SQL Virtual Machines

**When to use**:
- Need complete control over SQL Server
- Require OS-level access
- Migrating applications with minimal changes
- Need features not available in PaaS options

**Key features to know**:
- Full SQL Server feature parity
- OS-level access and control
- You manage updates and backups
- IaaS pricing model

## Authentication and Security

### Authentication Methods

**SQL Authentication**:
- Username and password authentication
- Credentials stored in SQL Server
- Works across all network boundaries
- Default for Azure SQL
- What we used in this lab: username "sqladmin" with a password

**Azure Active Directory Authentication**:
- Integration with Azure AD
- Supports multi-factor authentication
- Centralized identity management
- Can use managed identities from your applications
- Best practice for production applications

### Network Security

**Firewall Rules** (Critical for the exam):

You must understand that Azure SQL has a default-deny firewall. You need to explicitly allow access through:

1. **Server-level firewall rules**:
   - Apply to all databases on the server
   - Can be configured in the portal or via CLI
   - Specify IP address ranges

2. **Database-level firewall rules**:
   - Apply to specific databases
   - Configured using T-SQL commands
   - More granular control

3. **Virtual Network rules**:
   - Allow access from specific Azure VNets
   - Provide network isolation
   - Better security for production workloads

**Important exam point**: When a client tries to connect, they must pass through the firewall first. The error message clearly states the client IP address and tells you to add it to the firewall rules.

## Resource Hierarchy and Management

### Understanding the Hierarchy

For the AZ-204 exam, know this structure:

```
Resource Group
└── SQL Server (logical server)
    ├── Database 1
    ├── Database 2
    └── Database N
```

**Key points**:
- SQL Server is a logical container (not a VM)
- Server name must be globally unique
- Server has no compute cost by itself
- Databases inherit server-level authentication
- Deleting a server deletes all its databases
- Deleting a resource group deletes everything inside

### CLI Commands You Should Know

**Creating a SQL Server**:
```bash
az sql server create -g RESOURCE-GROUP -n SERVER-NAME -l LOCATION -u ADMIN-USER -p ADMIN-PASSWORD
```

**Creating a Database**:
```bash
az sql db create -g RESOURCE-GROUP -s SERVER-NAME -n DATABASE-NAME
```

**Managing Firewall Rules**:
```bash
az sql server firewall-rule create -g RESOURCE-GROUP -s SERVER-NAME -n RULE-NAME --start-ip-address X.X.X.X --end-ip-address Y.Y.Y.Y
```

**Deleting Resources**:
```bash
az sql db delete -g RESOURCE-GROUP -s SERVER-NAME -n DATABASE-NAME
az sql server delete -g RESOURCE-GROUP -n SERVER-NAME
```

## Connection Strings

For the exam, understand the format of connection strings:

**ADO.NET format**:
```
Server=tcp:YOUR-SERVER.database.windows.net,1433;Initial Catalog=DATABASE-NAME;User ID=USERNAME;Password=PASSWORD;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;
```

**Key components**:
- Server: fully qualified domain name (FQDN) with port 1433
- Initial Catalog: the database name
- User ID and Password: SQL authentication credentials
- Encrypt=True: enforces SSL/TLS encryption
- Connection Timeout: how long to wait for connection

**Best practice for applications**: Store connection strings in:
- Azure Key Vault (most secure)
- App Service Application Settings
- Azure App Configuration
- Never hardcode in source code

## Performance and Scaling

### Compute Tiers

**Provisioned compute**:
- Resources always available
- Predictable performance
- Billed per hour for capacity provisioned

**Serverless compute**:
- Automatically pauses when inactive
- Automatically resumes on demand
- Billed per second for compute used
- Has minimum and maximum vCore settings

### Service Tiers

1. **Basic**: Small workloads, 5 DTU max
2. **Standard**: Medium workloads, up to 3000 DTUs
3. **Premium**: High-performance, up to 4000 DTUs
4. **General Purpose**: Balanced, 2-80 vCores
5. **Business Critical**: Low latency, high availability, 2-80 vCores
6. **Hyperscale**: Very large databases, up to 100TB

## Backup and Recovery

**Automatic Backups** (know these retention periods):
- Full backups: Weekly
- Differential backups: Every 12-24 hours
- Transaction log backups: Every 5-10 minutes
- Default retention: 7 days (can extend to 35 days)
- Long-term retention: Up to 10 years

**Point-in-Time Restore**:
- Can restore to any point within retention period
- Creates a new database
- Can restore to different server or region
- Deleted databases can be restored (within retention period)

## Cost Optimization

**Exam tip - Know these cost factors**:

1. **SQL Server itself**: No cost - it's just a logical container
2. **Databases**: Charged based on:
   - Compute tier and size (vCores or DTUs)
   - Storage consumed
   - Backup storage (beyond included amount)
3. **Serverless**: Pay per second of compute used
4. **Reserved capacity**: Significant discount for 1-3 year commitments

## Lab Scenario Review

In our lab, we:

1. Created a resource group (container for resources)
2. Created a SQL Server (logical server, no cost)
3. Created a database (this is what incurs costs)
4. Configured firewall rules (required for access)
5. Connected and queried the database

The lab exercise demonstrates:
- Resource independence (database can be deleted, server remains)
- Resource hierarchy (deleting resource group deletes everything)
- Recovery considerations (can deleted databases be recovered?)

## Common Exam Scenarios

**Scenario 1**: Application can't connect to Azure SQL Database
- Check firewall rules first
- Verify connection string
- Check credentials
- Ensure database exists and is not paused (if serverless)

**Scenario 2**: Choosing the right Azure SQL option
- Variable workload = Serverless SQL Database
- Lift-and-shift migration = SQL Managed Instance or VM
- Need SQL Agent or linked servers = Managed Instance
- Need complete control = SQL on VM

**Scenario 3**: Securing database access
- Use Azure AD authentication
- Implement VNet integration
- Use Private Link for private connectivity
- Store credentials in Key Vault
- Enable Advanced Threat Protection

**Scenario 4**: Optimizing costs
- Use serverless for dev/test or intermittent workloads
- Use elastic pools for multi-tenant applications
- Use reserved capacity for predictable workloads
- Monitor and right-size based on actual usage

## Summary

For the AZ-204 exam, remember:

- Azure SQL has multiple service options for different scenarios
- Authentication can use SQL credentials or Azure AD
- Firewall rules are required for access
- Resource hierarchy: Resource Group > SQL Server > Databases
- SQL Server itself has no compute cost
- Connection strings follow a standard format
- Automatic backups enable point-in-time restore
- Choose serverless for variable/intermittent workloads
- Use managed identity and Key Vault for application credentials

Understanding these concepts will help you not only pass the AZ-204 exam but also design and implement effective database solutions in Azure.
