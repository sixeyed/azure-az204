# Virtual Networks - AZ-204 Exam Exercises

Virtual Networks appear in the AZ-204 exam under the Azure Infrastructure as a Service Solutions domain, which typically accounts for ten to fifteen percent of your exam score. While the exam focuses on developing solutions rather than infrastructure management, you need to understand how networking impacts your applications and how to make the right architectural decisions.

## Prerequisites

You should complete the basic vnet lab before diving into these exam-focused exercises. The fundamental concepts like vnet creation, subnet configuration, and basic networking are essential building blocks. These advanced exercises assume you're comfortable with the basics and ready to explore the production scenarios that appear in the AZ-204 exam.

## AZ-204 Exam Skills Covered

The exam expects you to demonstrate competency across a wide range of vnet capabilities. You'll need to understand security isolation and how vnets enable private communication between application components without exposure to the public Internet. Service integration is crucial because many Azure services integrate with vnets, including Azure SQL Database, Azure Storage, Azure Container Instances, Azure App Service, and more. Multi-tier architectures come up frequently, and you must know how to design and implement these using subnet patterns. Private endpoints and service endpoints are essential for securing PaaS services. Network Security Groups control traffic flow and act as distributed firewalls. Finally, you must understand how to integrate vnets with compute services because vnets rarely exist in isolation.

## Why VNets Matter for Developers

From a developer perspective, you're not just writing code when you build cloud applications - you're architecting solutions that need to be secure, performant, and cost-effective. Virtual Networks enable several critical capabilities that appear throughout the exam.

Security isolation is fundamental for any production application. Your application components can communicate privately without exposure to the public Internet, and the exam will test your understanding of when and why to use vnets for application security. Multi-tier architectures follow the classic pattern we demonstrated with frontend and backend subnets, and the exam expects you to know how to design these architectures and deploy applications into them. Service integration matters because many Azure services support vnet integration, and you need to understand which services support it and how to configure it. Cost optimization comes into play because keeping communicating services within the same vnet reduces data transfer costs and avoids egress charges.

## Understanding CIDR and IP Address Planning

CIDR notation and IP address planning are practical skills that appear in exam scenarios. When you see an address like 10.10.0.0/16, you should understand that the /16 means 16 bits are fixed, giving you 65,536 possible addresses. A /24 subnet gives you 256 addresses, with the first and last addresses reserved by Azure. Subnet ranges must not overlap with each other, and they must fall within the parent vnet range. These constraints are enforced by Azure, and the exam might present scenarios where you need to troubleshoot subnet configuration issues or design a subnet layout for a new application.

This becomes practical when working with operations teams who might ask you to deploy your application into a specific subnet. You need to understand what's possible and what constraints exist. The exam loves questions about subnet sizing - if you have a requirement for 500 IP addresses, what subnet size do you need? The answer is /23 which gives you 512 addresses, but remember that Azure reserves five addresses in each subnet, so you actually get 507 usable addresses.

## Network Security Groups

NSGs control inbound and outbound traffic at the subnet and NIC level, essentially acting as distributed firewalls throughout your vnet. Understanding how to configure NSG rules is essential for the exam because security is a major focus area.

NSG rules have several properties that work together to determine whether traffic is allowed or denied. Each rule has a priority number, and lower numbers are evaluated first - this is critical because the first matching rule determines the action, and no further rules are evaluated. The source and destination can be IP addresses, CIDR ranges, service tags, or application security groups. Service tags are particularly important for the exam - they represent groups of IP addresses for specific Azure services, like Storage or SQL Database, and using service tags means your rules automatically adapt when Azure's IP ranges change.

The default rules in an NSG are designed to allow vnet-to-vnet communication and load balancer health probes while blocking inbound traffic from the Internet. You can't delete these default rules, but you can override them with higher-priority custom rules. This is important for exam scenarios where you need to know what happens if you don't configure any custom rules - vnet-internal traffic works, but nothing can reach your resources from the Internet.

NSGs can be applied at the subnet level, which affects all resources in that subnet, or at the NIC level for per-resource control. You can apply both simultaneously, and Azure evaluates both sets of rules. The exam might present a troubleshooting scenario where traffic is blocked, and you need to identify that an NSG at one level is denying traffic even though the NSG at the other level allows it.

## Service Endpoints and Private Endpoints

Service endpoints and private endpoints represent two different approaches to securing access to Azure PaaS services from your vnet, and understanding the difference is crucial for the AZ-204 exam.

Service endpoints extend your vnet's identity to specific Azure services. When you enable a service endpoint for Storage or SQL Database on a subnet, traffic from that subnet to those services stays on the Azure backbone network instead of going out to the Internet and back in. The service sees requests as coming from your vnet, which lets you configure firewall rules on the service to allow only your vnet. The benefits include better security because traffic never leaves Azure's network, improved latency because of the direct path, and no additional cost. However, the service still has a public IP address and DNS name - you're just controlling who can reach it.

Private endpoints take a different approach by giving a PaaS service a private IP address in your vnet. You create a network interface in your subnet, and that NIC gets an IP address from your subnet's range. When you connect to the service, you're using that private IP, and the service becomes part of your vnet from a networking perspective. This enables more advanced scenarios like accessing services from on-premises networks through VPN or ExpressRoute, blocking all public access to the service completely, and using private DNS zones to resolve the service's hostname to the private IP automatically.

The exam will present scenarios and expect you to recommend either service endpoints or private endpoints based on requirements. If the scenario mentions on-premises access to the service, private endpoints are the answer. If cost is a major concern, service endpoints are free while private endpoints incur charges. If the requirement is to completely remove public access, private endpoints are the only option that truly makes the service private.

## VNet Integration for Azure Services

Different Azure services integrate with vnets in different ways, and the exam tests your knowledge of what's possible with each service.

Azure Virtual Machines are deployed directly into vnets and subnets, making them true vnet resources. Each VM gets a NIC connected to a subnet, and the VM uses the subnet's IP range for its private IP. The exam might ask about VM networking scenarios, and you should know that VMs can be in different subnets within the same vnet and communicate freely unless NSGs restrict traffic.

Azure App Service supports vnet integration, which is different from being deployed into a vnet. App Service is a PaaS service that runs in Microsoft's infrastructure, not in your vnet. VNet integration lets your app make outbound connections to resources in your vnet, which is essential when your app needs to access a database or API that's only accessible via private networking. The exam distinguishes between regional vnet integration, which works with vnets in the same region, and gateway-required integration, which works with vnets in other regions or on-premises networks.

Azure Container Instances can be deployed into vnets for private communication. This gives your containers private IP addresses from your subnet range and enables them to communicate with other vnet resources without public exposure. The exam might present a scenario where microservices need to communicate privately, and deploying container instances into a vnet is one solution.

Azure Functions supports vnet integration similar to App Service because Functions uses the same underlying platform. Your functions can access vnet resources through outbound integration, which is important for serverless scenarios where functions need to reach private databases or APIs. The exam tests whether you understand that this requires certain pricing tiers - not all Function plans support vnet integration.

Azure Kubernetes Service requires vnet integration at cluster creation time. AKS creates nodes in a subnet you specify, and those nodes get IPs from your subnet range. Understanding AKS networking is important for container orchestration scenarios in the exam, including how to choose between kubenet and Azure CNI networking.

## Multi-Tier Architecture Patterns

The frontend and backend subnet pattern we demonstrated represents a classic multi-tier architecture that appears frequently in exam scenarios. Understanding how to design and implement these patterns is essential.

The typical pattern puts web servers or API gateways in a frontend subnet with more permissive inbound rules allowing HTTP and HTTPS traffic. Application servers or business logic components go in an application tier subnet with rules allowing traffic only from the frontend. Database servers or data services reside in a backend subnet with very restrictive rules allowing traffic only from the application tier. This defense-in-depth approach means that even if the frontend is compromised, attackers can't reach the database directly.

NSGs at each subnet level enforce the traffic rules. The frontend subnet's NSG allows inbound traffic on ports 80 and 443 from the Internet but allows outbound traffic only to the application tier. The application tier's NSG allows inbound traffic only from the frontend subnet and allows outbound traffic only to the backend tier. The backend tier's NSG allows inbound traffic only from the application tier and denies all inbound traffic from elsewhere.

Application Security Groups simplify NSG rules when you have many VMs playing the same role. Instead of listing IP addresses in your NSG rules, you assign VMs to ASGs and reference those ASGs in your rules. When you add more web servers, you just add them to the web-servers ASG, and they automatically inherit all the appropriate rules. The exam might present a scenario with many VMs and ask how to simplify security rule management, and ASGs are the answer.

## VNet Peering for Cross-VNet Communication

VNet peering enables resources in different vnets to communicate as if they were in the same network. This is important for exam scenarios involving multiple vnets, perhaps for different environments or different business units.

Peering is non-transitive by default, which is a key exam point. If vnet A is peered with vnet B, and vnet B is peered with vnet C, resources in vnet A cannot reach vnet C unless you explicitly peer A with C. This prevents unintended connectivity and gives you precise control over network topology.

Gateway transit is a peering feature that appears in hybrid connectivity scenarios. If one vnet has a VPN gateway connecting to on-premises networks, you can enable gateway transit on the peering, allowing the other vnet to use that gateway without needing its own. This reduces costs and simplifies management, and the exam tests whether you understand when this is possible.

Peering works across regions, enabling global vnets where resources in different Azure regions communicate privately. This is useful for distributed applications and disaster recovery scenarios. The exam might describe a global application and ask how to enable private communication between regions, and vnet peering is the answer.

## Troubleshooting Network Connectivity

The exam includes scenarios where network connectivity isn't working, and you need to identify the cause and recommend solutions.

Common issues include NSG rules blocking traffic, which is often the first place to look. The effective security rules view in the Portal shows the combined result of all NSG rules at both subnet and NIC levels, making it easier to see what's actually being allowed or denied. Route tables can also cause issues if custom routes are incorrectly configured, overriding Azure's default routing. Overlapping IP ranges between peered vnets cause routing problems and prevent peering from working correctly. DNS resolution issues appear when using private endpoints, because the service's public DNS name needs to resolve to the private IP address instead of the public IP.

Network Watcher provides diagnostic tools that help troubleshoot these issues. IP flow verify checks whether traffic between two endpoints would be allowed or denied based on NSG rules. Connection troubleshoot performs end-to-end connectivity testing and identifies where failures occur. Next hop shows what route traffic would take to reach a destination. Packet capture lets you capture network traffic for detailed analysis. The exam expects you to know these tools exist and when to use them.

## Infrastructure as Code with ARM Templates

The lab challenge introduced ARM templates, which represent the declarative approach to infrastructure. This is important for the exam because modern Azure development relies heavily on infrastructure as code.

ARM templates describe the desired state of your resources rather than the imperative steps to create them. You can run the same template repeatedly and always get the same result because Azure automatically determines what changes need to be made. This idempotent behavior is essential for production environments and CI/CD pipelines.

Templates use JSON format with several sections. The parameters section defines values that can be provided at deployment time, like environment names or IP ranges. The variables section contains values calculated from parameters or used multiple times in the template. The resources section declares the actual Azure resources to create. The outputs section provides values back to the caller, like IP addresses or connection strings.

Bicep is Microsoft's newer template language that compiles to ARM templates but uses a simpler syntax. The exam includes questions about both ARM templates and Bicep, testing whether you understand when to use infrastructure as code versus imperative scripts.

Template deployment integrates with Azure DevOps and GitHub Actions for automated infrastructure deployment. The exam might describe a scenario where infrastructure needs to be deployed consistently across multiple environments, and ARM templates or Bicep are the recommended approach.

## AZ-204 Exam Study Points

Let's consolidate the key points you need to master for the exam. Virtual Networks provide private network infrastructure where resources communicate securely without public Internet exposure. Subnets divide vnets into logical segments for workload isolation and security control. CIDR notation defines IP address ranges, and you must understand subnet sizing and planning. NSGs control traffic flow using priority-based rules, service tags, and application security groups, and they can be applied at subnet or NIC levels. Service endpoints extend vnet identity to PaaS services while keeping the service's public endpoint. Private endpoints give PaaS services private IPs in your vnet and enable complete public access blocking.

VNet integration varies by service - VMs are deployed directly in vnets, App Service and Functions support outbound vnet integration, Container Instances can be deployed in vnets, and AKS requires vnet integration at cluster creation. Multi-tier architectures use multiple subnets with NSGs controlling traffic between tiers for defense in depth. VNet peering enables cross-vnet communication with non-transitive behavior and optional gateway transit.

Network Watcher provides diagnostic and troubleshooting tools including IP flow verify, connection troubleshoot, and packet capture. ARM templates and Bicep enable declarative infrastructure deployment with idempotent behavior suitable for CI/CD pipelines.

Understanding these concepts at a practical level is what separates passing from failing the exam. Microsoft tests application of knowledge, not memorization. Practice the labs, understand why each feature exists and when to use it, and you'll be well-prepared.

## Cleanup

When you're finished with these exercises, removing the resource groups deletes everything - all vnets, all subnets, all VMs, all NICs, all NSGs, all public IPs, and all associated resources. The deletion happens in the background when you use the no-wait flag, allowing you to continue working. This cleanup is important not just for cost management but also because the exam sometimes includes questions about proper resource lifecycle management and cost optimization.
