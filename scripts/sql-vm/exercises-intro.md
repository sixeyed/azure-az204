We've covered SQL Server Virtual Machines as the IaaS option when managed database services don't support features you need - providing complete control and access to all SQL Server capabilities. Now let's deploy and configure a SQL VM with custom functionality.

We'll start by exploring Azure SQL in the portal where you'll search for Azure SQL to see all the different deployment options. There are SQL databases for PaaS, SQL managed instances for near-complete SQL Server compatibility, and SQL virtual machines which give you full control. For the VM option you'll see Linux and Windows variants, different SQL Server versions like 2019 and 2017, and various SKUs including Standard, Enterprise, Web, and Express. This helps you understand when VMs are appropriate versus the managed options, which is when you need features not available in PaaS or require OS-level access.

Next you'll create a managed SQL Server with the CLI. First you'll need to find the right SQL Server VM image using commands like vm image list-offers to see SQL Server offerings from Microsoft, list-skus to find specific editions, and list to get the URN for a specific version. The URN format uniquely identifies VM images and looks like MicrosoftSQLServer:sql2019-ws2022:standard:version. Once you have the URN, you'll create the SQL Server VM using the standard vm create command, specifying the image URN, VM size for compute resources, admin credentials, and a unique DNS name for remote access. The VM gets created with SQL Server pre-installed, but it appears as a standard VM initially because you haven't registered it yet.

The next step is registering the VM for SQL Server management using the sql vm create command. This transforms your VM from generic infrastructure into a managed SQL Server resource, providing Azure-integrated management capabilities. You'll configure public connectivity so it's accessible from the internet, enable SQL authentication in addition to Windows authentication, and set up automatic firewall rules for SQL Server traffic. The registration process adds the SQL IaaS Agent Extension which gives you the management capabilities through Azure.

After registration, you'll customize the SQL Server VM by enabling RDP access so you can connect to the Windows desktop. You'll add a Network Security Group rule for port 3389, then connect via RDP and open SQL Server Management Studio. Here's where you'll do something you can't do with managed services: create a custom user-defined function that calls .NET code. This feature requires file system access to upload a DLL and elevated SQL Server permissions to enable CLR integration. You'll enable CLR integration, upload your .NET assembly, and register it as a SQL function that can be called from SQL queries.

For the lab challenge, you'll create new SQL Server logins with custom credentials, demonstrating another advantage of full control. You own the authentication mechanism without using standard Azure authentication, which gives you complete flexibility but also complete responsibility for security. When you're done, you'll clean up by deleting the resource group.
