# Service Bus Publish-Subscribe - AZ-204 Exam Preparation

Service Bus topics and the publish-subscribe pattern fall under the develop message-based solutions section of the AZ-204 exam, which typically accounts for ten to fifteen percent of the questions you'll encounter. This domain is crucial because messaging is fundamental to building scalable, decoupled cloud applications. The exam doesn't just test whether you can create topics and subscriptions - it evaluates your understanding of when to use pub-sub versus queuing, how to implement filtering, and how these patterns solve real-world architectural challenges.

## Understanding Message-Based Architecture Patterns

The exam expects you to distinguish between queuing and pub-sub patterns at a conceptual level. Queues implement point-to-point communication where there's one sender and one receiver, or multiple competing receivers that share the workload. Topics implement publish-subscribe where one or more senders publish messages, and multiple subscribers each receive their own copy of every message. This distinction is fundamental.

You need to identify scenarios where each pattern is appropriate. Queues work for task distribution where each task should be processed exactly once by one consumer. If you're distributing work items across multiple processors, queues provide the competing consumers pattern. Topics work for event distribution where multiple components need to react to the same event. If publishing an order-created event that triggers fulfillment, analytics, and auditing, topics provide the fan-out pattern where each subscriber processes the event independently.

## Service Bus Tier Selection

Understanding tiers is critical for exam success because tier selection appears in many scenario questions. The Basic tier supports only queues with a maximum message size of 256 KB. Standard tier adds support for topics and subscriptions while maintaining the 256 KB message limit. Premium tier provides enhanced performance with dedicated resources, increases message size to 100 MB, and adds virtual network integration for private connectivity.

When the exam presents requirements, you need to quickly assess which tier is necessary. If the scenario mentions topics or subscriptions, Basic tier is immediately eliminated. If large messages or VNet integration appear in requirements, Premium is required. Most enterprise production scenarios call for Standard or Premium based on throughput and feature needs.

## Topics and Subscriptions

Topics serve as destinations where publishers send messages, and they support multiple subscriptions receiving copies. Understanding this architecture is essential. Topics forward messages to all subscriptions, implementing true fan-out. Subscriptions act as independent queues, each receiving copies of topic messages. Each subscription maintains its own message state independently from other subscriptions. Time-to-live and maximum size can be configured to manage message retention and storage capacity.

Subscriptions provide the routing and filtering mechanism. Each subscription can have filters determining which messages it receives, and rules can transform or annotate messages. Multiple concurrent receivers can consume from a single subscription, implementing competing consumers at the subscription level. Different subscriptions can process at different speeds without affecting each other, which is powerful for heterogeneous systems.

## Authorization and Security

The exam tests your knowledge of securing Service Bus resources through Shared Access Signatures. Authorization rules define specific rights - Send allows publishing messages, Listen allows consuming messages, and Manage provides administrative capabilities. The principle of least privilege guides security design - you create specific policies for publishers with only Send rights and separate policies for subscribers with only Listen rights. This compartmentalization limits the damage if credentials are compromised.

Connection strings contain everything applications need to authenticate. They include the endpoint identifying your namespace's servicebus.windows.net address, the authorization rule name, and the shared access key. Understanding this structure helps troubleshoot authentication issues.

For production scenarios, Azure Active Directory integration provides enhanced security. Managed identities eliminate secrets from code entirely, using Azure's identity infrastructure for authentication. The exam expects you to recognize that managed identity is the preferred approach for security-sensitive applications.

## Message Time-to-Live

Understanding TTL is crucial for managing message lifecycle and storage costs. TTL can be set at the topic level, providing a default for all messages. Individual messages can override the topic-level TTL if needed. Expired messages are removed automatically, preventing indefinite accumulation. The exam might present scenarios requiring specific message retention periods.

The format uses ISO 8601 duration notation, which appears complex but is powerful. P0DT0H10M1S represents zero days, zero hours, ten minutes, and one second. Understanding this format helps configure TTL correctly. The exam might ask you to configure messages to expire after thirty minutes or remain available for twenty-four hours, testing your grasp of TTL configuration.

## Application Development Patterns

The exam includes questions about using the Azure.Messaging.ServiceBus SDK. The patterns are consistent whether working with queues or topics, which is elegant. Sending messages to topics uses identical code to sending to queues - the sender doesn't distinguish between them. Receiving messages from subscriptions requires specifying both the topic name and subscription name, differentiating it from queue receivers that only need the queue name.

Proper disposal of clients and processors is tested. The SDK uses disposable patterns, and you need to ensure proper cleanup. Error handling and retry logic appear in exam scenarios - understanding transient fault handling and exponential backoff is important. The exam might present code with missing error handling and ask you to complete it correctly.

## Filters and Rules

Filters determine which messages each subscription receives, enabling selective routing. SQL filters provide flexibility through expressions that evaluate message properties. An expression like priority equals high AND region equals east demonstrates SQL filter syntax. These filters are powerful but have performance costs because Service Bus evaluates them for every message.

Correlation filters match specific properties more efficiently and are the recommended approach for simple matching. They're optimized for performance, making them suitable for high-throughput scenarios. The exam expects you to recommend correlation filters over SQL filters when simple property matching suffices.

Boolean filters are either TrueFilter receiving all messages or FalseFilter receiving no messages. TrueFilter is the default when no filter is specified. Understanding when to use each filter type and their performance implications matters for exam questions about optimizing message routing.

## Common Exam Scenarios

Scenario one presents an application that needs to send order notifications, with multiple services processing each notification independently. Each service should receive all notifications. The answer is a Service Bus topic with a subscription for each service. This demonstrates the fan-out pattern where one published message reaches multiple independent processors.

Scenario two requires messages to expire after fifteen minutes if not processed, preventing indefinite accumulation. The answer is setting default-message-time-to-live when creating the topic or queue. This tests your understanding of message lifecycle management.

Scenario three involves a publisher application needing to send messages to a Service Bus topic, asking what minimum permission is required. The answer is Send rights on the topic. This tests the principle of least privilege and authorization model understanding.

Scenario four presents three services needing to process order events, with each service processing at different speeds. How do you ensure each service can process at its own pace without affecting others? The answer is creating three subscriptions on the topic, one for each service. Each subscription maintains independent state, allowing different processing rates.

## Design Patterns

The exam expects familiarity with architectural patterns implemented using Service Bus. The fan-out pattern has one publisher sending to multiple subscribers via a topic, enabling event broadcasting. Competing consumers has multiple receivers on the same subscription for load balancing, distributing work across processors. Message filtering uses subscription rules to route specific messages to appropriate consumers based on properties. Dead-letter queues handle messages that can't be processed, providing error isolation and debugging capabilities.

Understanding when to apply each pattern is what the exam tests. You won't just be asked to define patterns - you'll see scenarios requiring you to recommend the appropriate pattern.

## Performance and Scaling Considerations

The exam may include questions about performance optimization. Partitioning provides higher throughput in Premium tier by distributing load across multiple message brokers. Message batching sends multiple messages in one operation, reducing network overhead and improving efficiency. Prefetching improves receiver performance by fetching messages ahead of explicit receive calls. Session handling enables ordered message processing when FIFO guarantees are required.

Understanding these optimization techniques helps you answer performance-related questions. When a scenario describes high-throughput requirements or performance problems, you need to recognize which optimization applies.

## Monitoring and Troubleshooting

The exam tests your ability to monitor and diagnose Service Bus issues. Checking message counts in subscriptions reveals backlogs and processing problems. The Azure Portal's Service Bus Explorer lets you inspect message contents and structure without consuming them. Querying subscription properties with Azure CLI provides programmatic access to metrics and state. Understanding message states - active, dead-lettered, and scheduled - helps diagnose processing issues.

When exam scenarios present problems like messages not being processed or subscribers not receiving expected messages, you need to know how to investigate using these tools.

## Key Takeaways for the Exam

Topics implement pub-sub while queues implement point-to-point messaging. This fundamental distinction guides architecture decisions. Standard tier or higher is required for topics - Basic tier only supports queues. Each subscription gets a copy of every matching message, enabling true fan-out. Separate authorization rules for send and listen operations follow security best practices. TTL prevents indefinite message accumulation, managing storage and costs. Multiple receivers on one subscription compete for messages, implementing load balancing. Multiple receivers on different subscriptions each get all messages, implementing fan-out.

These principles appear repeatedly across exam questions. Memorizing them isn't enough - you need to apply them to scenarios.

## Practice Recommendations

To prepare effectively, practice creating topics and subscriptions via both CLI and Portal to build familiarity. Write code to send and receive messages, understanding the SDK patterns. Experiment with different authorization configurations to grasp the security model. Understand when to use topics versus queues through scenario analysis. Review the official Microsoft Learn modules on Service Bus for comprehensive coverage.

The AZ-204 exam is scenario-based, testing your ability to apply knowledge to solve real problems. Hands-on experience builds the intuition needed to recognize patterns and recommend solutions under exam time pressure. This lab provides practical experience with the patterns and practices you'll encounter on the exam, giving you the foundation to handle Service Bus questions confidently.
