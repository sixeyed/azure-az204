# Azure Container Instances - AZ-204 Exam Focus

## Exam Relevance

Azure Container Instances appears in the AZ-204 exam under the "Implement Azure Container Instances" objective within the "Implement containerized solutions" domain. This typically represents 5-10% of the exam content.

## Key Exam Topics

### 1. When to Use ACI vs Other Compute Options

**Critical for the exam**: Know when ACI is appropriate compared to alternatives.

**Azure Container Instances is best for**:
- Simple containerized applications without orchestration needs
- Burst workloads and batch jobs
- Development and test environments
- Event-driven applications triggered by Azure services
- Task automation and CI/CD scenarios

**NOT appropriate for**:
- Complex microservices requiring service discovery
- Applications needing auto-scaling based on metrics
- Stateful applications requiring persistent volumes
- Production workloads needing high availability and load balancing
- *(For those scenarios, use Azure Kubernetes Service)*

**Exam tip**: Questions often present scenarios and ask you to choose the right compute service. Look for keywords like "simple," "temporary," "task," or "single container" to identify ACI scenarios.

---

### 2. Creating and Deploying Container Instances

**Core Skills for AZ-204**:

**Using Azure CLI (Most Common on Exam)**:

Basic container deployment:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --dns-name-label <dns-prefix> \
  --ports <port-numbers>
```

**Key parameters you must know**:
- `--resource-group`: Target resource group (required)
- `--name`: Container instance name (required)
- `--image`: Container image from a registry (required)
- `--ports`: Exposed ports for external access
- `--dns-name-label`: Public DNS prefix
- `--cpu`: Number of CPU cores (default: 1)
- `--memory`: Memory in GB (default: 1.5)
- `--os-type`: Linux (default) or Windows
- `--ip-address`: Public or Private
- `--location`: Azure region

**With environment variables**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --environment-variables 'KEY1'='value1' 'KEY2'='value2'
```

**Secure environment variables for sensitive data**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --secure-environment-variables 'API_KEY'='<api-key>' 'DB_PASSWORD'='<password>'
```

**Exam tip**: Secure environment variables are NOT displayed in the Azure portal or CLI output. This is a common exam question about protecting sensitive data.

---

### 3. Container Image Sources

**Know the three primary image sources**:

**1. Docker Hub (Public Registry)**:
```bash
--image nginx:latest
--image courselabs/simple-web:6.0
```

**2. Azure Container Registry (Private)**:
```bash
--image <registry-name>.azurecr.io/<image-name>:<tag> \
--registry-login-server <registry-name>.azurecr.io \
--registry-username <username> \
--registry-password <password>
```

**3. Other Private Registries**:
```bash
--image myregistry.io/myimage:tag \
--registry-login-server myregistry.io \
--registry-username <username> \
--registry-password <password>
```

**Exam tip**: Questions often involve pulling images from Azure Container Registry. Remember that you need registry credentials unless using managed identity or admin access enabled on ACR.

---

### 4. Networking Configuration

**Public IP Address (Default)**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --ip-address Public \
  --dns-name-label <unique-dns-name> \
  --ports 80 443
```

Results in FQDN: `<dns-name-label>.<region>.azurecontainer.io`

**Private IP Address**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --ip-address Private \
  --vnet <vnet-name> \
  --subnet <subnet-name>
```

**Port Configuration**:
- You can expose multiple ports: `--ports 80 443 8080`
- TCP is default; UDP requires protocol specification
- Ports must match what the container application listens on

**Exam tip**: Private ACI containers require a dedicated subnet and cannot coexist with other Azure resources in that subnet. This is a common exam question.

---

### 5. Container Groups (Multi-Container Deployments)

**Critical concept**: A container group is a collection of containers scheduled on the same host machine. They share lifecycle, network, and storage resources.

**Container groups are typically defined in**:
- Azure Resource Manager (ARM) templates
- YAML files
- Not directly via simple `az container create` commands

**YAML example structure** (know the schema):
```yaml
apiVersion: '2019-12-01'
location: eastus
name: my-container-group
properties:
  containers:
  - name: container1
    properties:
      image: <image-1>
      resources:
        requests:
          cpu: 1
          memoryInGb: 1.5
      ports:
      - port: 80
  - name: container2
    properties:
      image: <image-2>
      resources:
        requests:
          cpu: 1
          memoryInGb: 1.5
  osType: Linux
  ipAddress:
    type: Public
    ports:
    - protocol: tcp
      port: 80
    dnsNameLabel: <dns-label>
tags: {}
type: Microsoft.ContainerInstance/containerGroups
```

**Deploy from YAML**:
```bash
az container create --resource-group <resource-group-name> --file deployment.yaml
```

**Exam tip**: Container groups are often used for sidecar patterns (main app + logging/monitoring container). Exam questions test your understanding of when to use groups vs. single containers.

---

### 6. Resource Allocation and Limits

**CPU and Memory Requests**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --cpu 2 \
  --memory 4
```

**Valid CPU values**: 0.5, 1, 2, 3, 4 (in cores)
**Valid Memory values**: 0.5 to 16 GB

**Exam tip**: You cannot change CPU or memory for a running container. You must delete and recreate it. This is a common exam scenario question.

---

### 7. Container Restart Policies

**Three restart policies**:

**1. Always** (Default):
```bash
--restart-policy Always
```
Container restarts on any exit, successful or failed. For long-running services.

**2. OnFailure**:
```bash
--restart-policy OnFailure
```
Container restarts only on failure (non-zero exit code). For tasks that might fail and should retry.

**3. Never**:
```bash
--restart-policy Never
```
Container runs once and stops. For one-time tasks or batch jobs.

**Exam tip**: Exam questions often ask which restart policy to use for specific scenarios like batch processing (Never) vs. web services (Always).

---

### 8. Monitoring and Diagnostics

**View container logs**:
```bash
az container logs --resource-group <resource-group-name> --name <container-name>
```

**Stream logs in real-time**:
```bash
az container logs --resource-group <resource-group-name> --name <container-name> --follow
```

**Get container events and state**:
```bash
az container show --resource-group <resource-group-name> --name <container-name>
```

**For specific container in a group**:
```bash
az container logs --resource-group <resource-group-name> --name <group-name> --container-name <specific-container>
```

**Exam tip**: Know the difference between `logs` (application output) and `show` (container metadata and state). Exam questions test when to use each.

---

### 9. Persistent Storage with Azure Files

**Mount Azure Files share**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --azure-file-volume-account-name <storage-account-name> \
  --azure-file-volume-account-key <storage-key> \
  --azure-file-volume-share-name <share-name> \
  --azure-file-volume-mount-path /mnt/data
```

**Key concepts**:
- ACI supports Azure Files for persistent storage
- The volume is mounted to a path inside the container
- Multiple containers can share the same volume
- Data persists beyond container lifecycle

**Exam tip**: ACI does NOT support Azure Disk. Only Azure Files is supported for persistent volumes. This is a common exam trick question.

---

### 10. Integration with Azure Container Registry

**Enable admin access on ACR**:
```bash
az acr update --name <registry-name> --admin-enabled true
```

**Get ACR credentials**:
```bash
az acr credential show --name <registry-name>
```

**Deploy from ACR with credentials**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <registry-name>.azurecr.io/<image-name>:<tag> \
  --registry-login-server <registry-name>.azurecr.io \
  --registry-username <registry-name> \
  --registry-password <password>
```

**Using managed identity** (more secure):
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <registry-name>.azurecr.io/<image-name>:<tag> \
  --assign-identity \
  --acr-identity <user-assigned-identity-id>
```

**Exam tip**: Managed identities eliminate the need for passwords. Expect scenario questions about securing ACR access.

---

### 11. Windows vs. Linux Containers

**Specify OS Type**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <windows-image> \
  --os-type Windows
```

**Key differences to know**:
- **Linux** is default and most common
- **Windows** containers are larger and slower to start
- Windows containers required for .NET Framework apps
- Different base image ecosystems
- Pricing is the same per resource consumption

**Exam tip**: Know that older .NET Framework applications require Windows containers, while .NET Core/.NET 5+ can run on Linux.

---

### 12. Execution of Commands in Containers

**Override default command**:
```bash
az container create \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --image <image-name> \
  --command-line "/bin/bash -c 'echo hello && sleep 3600'"
```

**Execute command in running container**:
```bash
az container exec \
  --resource-group <resource-group-name> \
  --name <container-name> \
  --exec-command "/bin/bash"
```

**Exam tip**: The `exec` command is useful for troubleshooting but requires the container to be running.

---

### 13. Pricing and Cost Management

**Pricing factors**:
- **CPU cores**: Per core per second
- **Memory**: Per GB per second
- **OS type**: Same rate for Linux and Windows
- **No charge for stopped containers** (but they're deleted, not stopped)

**Cost optimization tips for exam**:
- Use restart policy "Never" for one-time tasks
- Delete containers when not needed
- Right-size CPU and memory
- Use container groups to share resources

**Exam tip**: ACI charges per second of execution. Questions may ask how to minimize costs for specific scenarios.

---

### 14. Security Best Practices

**For the AZ-204 exam, know these security practices**:

1. **Use secure environment variables** for sensitive data
2. **Use managed identities** instead of passwords for ACR
3. **Deploy to virtual networks** for private communication
4. **Don't expose unnecessary ports**
5. **Pull images from private registries** (ACR, not Docker Hub) for production
6. **Regularly update base images** to patch vulnerabilities

**Exam tip**: Security scenarios often involve choosing managed identity over storing credentials.

---

## Common Exam Scenarios

### Scenario 1: Simple Web App Deployment
**Question**: Deploy a containerized web API that needs to be publicly accessible.

**Solution**: Use `az container create` with public IP, exposed port, and DNS label.

### Scenario 2: Batch Processing
**Question**: Run a data processing task that should execute once and not restart.

**Solution**: Use restart policy "Never" with appropriate exit handling.

### Scenario 3: Sidecar Pattern
**Question**: Deploy an app with a separate logging container.

**Solution**: Use container group with YAML definition containing both containers.

### Scenario 4: Private Network Access
**Question**: Deploy container that communicates with VNet resources.

**Solution**: Deploy with private IP to a dedicated subnet in the VNet.

### Scenario 5: Secure Image Pull
**Question**: Pull from ACR without embedding credentials.

**Solution**: Use managed identity with ACR role assignment.

---

## Quick Reference Commands

**Create basic container**:
```bash
az container create -g <rg> -n <name> --image <image> --ports 80 --dns-name-label <dns>
```

**Create with environment variables**:
```bash
az container create -g <rg> -n <name> --image <image> --environment-variables 'KEY'='value'
```

**Create with secure variables**:
```bash
az container create -g <rg> -n <name> --image <image> --secure-environment-variables 'SECRET'='<value>'
```

**Create with ACR image**:
```bash
az container create -g <rg> -n <name> --image <registry>.azurecr.io/<image> --registry-username <user> --registry-password <password>
```

**Create with specific resources**:
```bash
az container create -g <rg> -n <name> --image <image> --cpu 2 --memory 4
```

**Create with restart policy**:
```bash
az container create -g <rg> -n <name> --image <image> --restart-policy OnFailure
```

**View logs**:
```bash
az container logs -g <rg> -n <name>
```

**Show container details**:
```bash
az container show -g <rg> -n <name>
```

**Delete container**:
```bash
az container delete -g <rg> -n <name>
```

---

## Exam Study Tips

1. **Practice the CLI**: The exam heavily tests CLI commands. Know the syntax without looking it up.

2. **Understand limitations**: Know what ACI can't do (persistent disks, auto-scaling, complex orchestration).

3. **Compare services**: Be able to quickly choose between ACI, Web Apps, AKS, and VMs based on requirements.

4. **YAML syntax**: For container groups, understand the YAML structure even if you don't memorize every field.

5. **Security focus**: Managed identities and secure environment variables appear frequently.

6. **Networking**: Understand public vs. private IP, VNet integration, and DNS configuration.

7. **Scenario-based learning**: Practice with scenario questions that describe requirements and ask for solutions.

---

## Key Exam Takeaways

- ACI is for **simple, single-container** or **container group** deployments
- **Three ways to deploy**: Portal, Azure CLI, YAML/ARM templates
- **Two network modes**: Public IP with DNS or Private IP in VNet
- **Three restart policies**: Always, OnFailure, Never
- **Storage**: Only Azure Files is supported, not Azure Disk
- **Security**: Use secure environment variables and managed identities
- **Cost model**: Pay per second for CPU and memory consumption
- **Container groups**: Share lifecycle, network, and storage
- **No stop/start**: Containers are deleted when not running

Good luck on your AZ-204 exam!
