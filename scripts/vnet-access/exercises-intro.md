We've covered the powerful security features Azure provides for controlling network access including Network Security Groups, Azure Bastion, and VNet peering. Now let's apply these capabilities to lock down and secure virtual networks.

Creating a VM and an NSG starts with creating a Resource Group, VNet, and subnet using standard commands. You create a Network Security Group using az network nsg create with just a name and resource group. Opening the NSG in the Portal shows default rules applied to all new NSGs: allow incoming from VNet and Azure LB, deny all other incoming, allow outgoing to VNet and internet, and default deny all outgoing. You check the location and if your NSG is in a different region from your VNet they can't be associated, so you need to create a new NSG in the same region. You add a new rule to allow incoming traffic from the internet on port 80 using az network nsg rule create with parameters for direction, access, priority, source address prefixes, and destination port ranges. You attach the NSG to the subnet using az network vnet subnet update, setting the network-security-group parameter. Opening the VNet in the Portal lets you check the subnet confirms the NSG is attached, and any services deployed into the VNet are subject to these NSG rules now. Port 22 for SSH and 3389 for RDP are blocked, so if you had VMs running you couldn't access them anymore.

Connecting with Bastion solves the locked-down access problem. You create a basic Linux VM using password authentication instead of SSH keys. Checking the VM in the Portal shows the NSG listed in the Networking tab even though you didn't explicitly set it when creating the VM. When you try to connect via SSH using the public IP address, it times out because SSH uses port 22 which is blocked by NSG rules. Azure Bastion provides secure access to VMs in locked-down networks. You open the VM in the Portal, click Connect and choose Bastion, then Create Azure Bastion using defaults. This takes a few minutes because the Bastion service is created at the VNet level and the same Bastion instance can be used for all VMs in the VNet. When setup completes, you enter username and password and click Connect. A browser window opens with a terminal connection to the VM, but port 22 is still blocked for direct access. In your VM session you install Nginx web server, then browse to the VM's public IP address to verify traffic is allowed through the NSG on port 80.

Creating second VNet and peer demonstrates VNet isolation and connectivity. You create a new VNet with IP address range 10.20.0.0 slash 16 in a different region from the first VNet and a new subnet with range 10.20.1.0 slash 24. You need to plan your networking in advance because if you want to peer two VNets they need to have non-overlapping IP address ranges. You create a new VM attached to the new VNet which has no NSG, and Azure creates a new NSG for the VM with an additional default rule to allow incoming SSH traffic. You print the private IP addresses of the two VMs and connect to the new VM, checking if you can reach the web server on the first VM using the private IP address. It times out because the VNets are isolated. You peer the VNets using az network vnet peering create in both directions, which ensures you can't peer onto someone else's VNet that you don't have access to. Opening the VNet in the portal under Peerings shows the VNets are peered with status Connected. Now VMs in subnet2 can reach VMs in subnet1. In the SSH session for your second VM, accessing the first VM works now using the private IP address, and peering doesn't add a new NIC to the VM, it takes care of routing between the networks.

NSGs provide network-level security, Bastion enables secure management access, and VNet peering connects isolated networks with non-overlapping address spaces, all essential for building secure, multi-tier Azure applications.
