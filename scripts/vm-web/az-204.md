# Virtual Machines - Web Server - AZ-204 Exam Exercises

Web servers on Virtual Machines represent a common IaaS pattern that appears in AZ-204 exam scenarios. While the exam emphasizes Platform as a Service options like App Service for hosting web applications, understanding how to deploy and configure web servers on VMs is important for scenarios requiring OS-level control, legacy application support, or specific networking requirements. The exam tests your knowledge of public IP addresses, DNS configuration, Network Security Groups, and VM state management for cost optimization.

## Prerequisites

You should complete the basic VM lab before working with web server deployments. Understanding VM creation, SSH connectivity, and basic networking provides the foundation for this lab. These exercises assume you're comfortable with VM basics and ready to explore the additional configuration required for internet-facing web servers.

## AZ-204 Exam Skills Covered

The exam tests several concepts through web server scenarios on VMs. You need to understand public IP addresses including dynamic versus static allocation and how deallocation affects IP retention. DNS configuration with Azure-provided FQDN names ensures consistent access even when IP addresses change. Network Security Groups and inbound security rules control access to web servers, implementing the principle of least privilege by explicitly allowing only required traffic. VM state management including the difference between stopped and deallocated states affects billing and is crucial for cost optimization. Installing and configuring software on VMs through SSH demonstrates post-deployment configuration. Finally, choosing between VMs and App Service for web hosting requires evaluating trade-offs between control and management overhead.

## Public IP Addresses

Public IP addresses enable internet connectivity to your VMs, and understanding how they work is fundamental to many exam scenarios. Every web-facing VM needs a public IP to receive traffic from the internet.

Azure manages pools of public IP addresses in each region. When you create a VM and request a public IP, Azure assigns an address from the available pool. You cannot choose a specific IP address number, which is an important constraint the exam might test. Azure controls the IP allocation to manage their address space efficiently.

Public IPs can be dynamically or statically allocated. Dynamic allocation means Azure assigns an IP when the VM starts and releases it when the VM deallocates. This is the default behavior and works fine for many scenarios because you can use DNS names to access the VM regardless of which IP gets assigned. Static allocation means the IP address is reserved specifically for your resource and persists even when the VM is deallocated. Static IPs cost slightly more but provide consistency when you need a fixed address.

The relationship between VM state and IP addresses is crucial for the exam. When a VM is running, it has its assigned public IP. When you stop the VM through the operating system or portal, the VM stops but the IP is retained. However, you still incur charges for the VM and allocated resources. When you deallocate the VM using az vm deallocate, Azure releases the compute resources and, for dynamic IPs, releases the IP address back to the pool. You stop incurring compute charges, but dynamic IPs are lost. When you restart a deallocated VM with dynamic IP, it gets a new address from the pool.

Understanding allocation methods helps you answer exam questions about IP retention. Questions might describe scenarios like "the web server is accessible at a specific IP, but after maintenance it has a different IP" where dynamic allocation explains the behavior. Or "the application requires a fixed IP address that persists through restarts" where static allocation is the answer.

Public IP addresses are separate Azure resources with their own lifecycle. They appear in your resource group and can be managed independently of the VM. You can create a public IP resource first, then attach it to a VM. You can detach a public IP from one VM and attach it to another. This flexibility supports advanced scenarios like failover where you move an IP between VMs. The exam might ask about managing public IPs separately from VMs.

The standard SKU for public IPs provides additional features compared to basic SKU including zone redundancy, support for availability zones, and compatibility with standard load balancers. Premium tier features cost more but provide higher SLAs. The exam expects you to know when to recommend standard versus basic SKUs based on requirements.

## DNS Names in Azure

Azure provides DNS names for public IPs through the Azure-provided FQDN feature. Understanding how DNS integration works helps you answer exam questions about name resolution and high availability.

When you create a VM and specify the public-ip-address-dns-name parameter, Azure registers a DNS name in the cloudapp.azure.com domain. The format is your-chosen-name.region.cloudapp.azure.com. This name is globally unique within the region, so you must choose a name not already in use. The exam might present scenarios where DNS name creation fails due to name conflicts.

The key benefit of using Azure-provided DNS names is that they automatically update when the underlying IP address changes. If your VM has a dynamic IP and gets deallocated then restarted with a new IP, the DNS record automatically updates to point to the new IP. Your applications can always use the same DNS name regardless of IP changes. This resilience is important for scenarios involving maintenance, scaling, or disaster recovery.

Azure DNS provides the name resolution service for these cloudapp.azure.com names. The DNS infrastructure is highly available across multiple Azure datacenters, providing reliability independent of your VM. Even if your VM is stopped, the DNS name remains registered. When you deallocate the VM, the DNS name still exists but points to no IP until you restart the VM.

Custom domain names provide branding and flexibility beyond Azure-provided names. You can register your own domain like myapp.com and point it to your VM's public IP or Azure-provided FQDN. This involves configuring DNS records with your domain registrar. The exam might ask about custom domains where you need to understand DNS CNAME or A records and how they integrate with Azure public IPs.

For production web applications, the exam expects you to recognize that direct VM public IPs aren't usually the best approach. Azure Traffic Manager, Application Gateway, or Front Door provide better solutions for high availability, geographic distribution, and SSL termination. These services sit in front of your VMs and provide additional capabilities. The exam presents architectural scenarios where you must choose appropriate options.

## Network Security Groups for Web Traffic

Network Security Groups are fundamental to securing VMs and appear extensively in exam questions about network security. Understanding how to configure NSG rules for web servers is essential.

The default NSG configuration for VMs allows outbound internet access but denies inbound access from the internet. This security-first approach means new VMs cannot receive web traffic until you explicitly allow it. This default behavior frequently appears in exam scenarios described as "deployed a web server but cannot access it" where adding an NSG rule is the solution.

NSG rules specify several properties that control traffic filtering. The priority determines evaluation order, with lower numbers evaluated first. Rules are processed in priority order until a match is found, then processing stops. The source specifies where traffic comes from, using IP addresses, service tags like Internet, or application security groups. The destination specifies where traffic goes, typically the VM or subnet. The port specifies which port to allow or deny, like eighty for HTTP or four hundred forty-three for HTTPS. The protocol can be TCP, UDP, or Any. And the action is either Allow or Deny.

For web servers, you typically create rules allowing inbound traffic on port eighty for HTTP and port four hundred forty-three for HTTPS from any internet source. The source is set to Internet or Any to allow traffic from all public IPs. The destination is your VM or the subnet containing your VMs. The priority should be lower than the default deny-all rule at priority sixty-five thousand five hundred to ensure your allow rule is evaluated first.

The exam tests whether you understand the security implications of NSG rules. Allowing traffic from Any source on port eighty means anyone on the internet can access your web server, which is appropriate for public websites but might not be suitable for internal applications. More restrictive rules might allow traffic only from specific IP ranges like your corporate network. Understanding when to use restrictive versus permissive rules demonstrates security best practices.

Application Security Groups provide a way to group VMs by role and reference those groups in NSG rules. Instead of using IP addresses, you create ASGs like WebServers, AppServers, and DatabaseServers, assign VMs to these groups, then write NSG rules that reference the groups. This approach makes rules more readable and maintainable as your infrastructure grows. The exam might present multi-tier application scenarios where ASGs simplify security configuration.

NSG flow logs provide visibility into what traffic is being allowed or denied. These logs integrate with Network Watcher and can be analyzed to understand traffic patterns, troubleshoot connectivity issues, or detect security threats. The exam might ask about troubleshooting network connectivity where flow logs provide the diagnostic data needed.

## VM State Management and Billing

Understanding the different VM states and their billing implications is crucial for cost optimization questions on the exam. Azure charges for VMs based on their state, and knowing how to minimize costs while maintaining availability is important.

A running VM incurs compute charges for the VM size, storage charges for attached disks, networking charges for data transfer, and charges for public IP addresses. The compute charges are typically the largest component and are based on the VM size and how long the VM runs. Understanding this helps you identify opportunities for cost savings.

A stopped VM is one that has been stopped through the operating system or the portal Stop button but has not been deallocated. In this state, Azure continues to reserve the compute resources and you continue to incur charges for most resources. Storage and public IPs still cost money. The VM can start quickly because resources are still allocated. The exam might describe continued charges despite a VM being stopped, where the answer is that stop without deallocate continues billing.

A deallocated VM has been explicitly deallocated using az vm deallocate or the portal Deallocate option. Azure releases the compute resources, and you stop incurring compute charges. You still pay for storage since disks persist, and you still pay for static public IPs if configured. Dynamic public IPs are released. The VM takes longer to start because Azure must allocate compute resources again. Deallocation is the way to stop billing while preserving the VM for later use.

The difference between stop and deallocate is frequently tested on the exam. Questions might ask "how can you minimize costs for development VMs used only during business hours" where the answer involves deallocating VMs outside working hours. Or "how can you ensure VMs can start quickly while minimizing costs" where stop without deallocate balances cost and startup time but doesn't eliminate compute charges.

Automatic shutdown schedules in the portal help manage costs by automatically deallocating VMs at specified times. You can configure schedules like deallocate every evening at six PM and optionally notify users before shutdown. This feature is perfect for development and test environments. The exam might present cost optimization scenarios where scheduled shutdown is part of the solution.

Starting a deallocated VM requires understanding what resources get allocated. The VM gets a new dynamic public IP if it had one previously, or retains a static IP if configured for static allocation. The VM boots up and applications start. The entire process takes a few minutes compared to seconds for restarting a stopped but not deallocated VM.

## Installing Software on VMs

Installing and configuring software on VMs represents post-deployment configuration that the exam tests through scenarios requiring custom software or specific configurations not available in marketplace images.

SSH for Linux VMs provides secure remote access for installing software. You connect using ssh with the VM's public IP or DNS name. Azure automatically configures SSH key authentication when you create Linux VMs, providing more security than password authentication. Once connected, you use standard Linux package management commands like apt-get for Ubuntu or yum for Red Hat to install software.

The installation process for web servers like Nginx or Apache follows standard Linux procedures. Update package lists with apt-get update, then install packages with apt-get install. The -y flag automatically confirms prompts, essential for scripting. After installation, services typically start automatically. Testing locally with curl confirms the web server is working before addressing networking configuration.

Post-deployment scripts and extensions provide automation for software installation. Rather than manually SSH to each VM, you can use custom script extensions to run installation scripts automatically. This automation is crucial for deploying multiple identical VMs or for CI/CD pipelines. The exam might ask how to ensure consistent software configuration across many VMs where extensions or custom images are the answer.

Configuration management tools like Ansible, Chef, or Puppet provide ongoing management beyond initial installation. These tools can apply configuration updates, install security patches, and maintain desired state across fleets of VMs. The exam contrasts one-time installation scripts with ongoing configuration management, expecting you to recommend appropriate tools based on requirements.

The choice between installing software post-deployment versus using custom images with pre-installed software depends on your scenario. Post-deployment installation keeps images simple but adds time to VM creation. Pre-installed software in custom images speeds deployment but requires image maintenance. The exam tests this trade-off through scenarios with different requirements for deployment speed versus configuration flexibility.

## VMs vs App Service for Web Hosting

The exam frequently tests your ability to choose between VMs and App Service for hosting web applications. Understanding the trade-offs helps you recommend appropriate solutions based on requirements.

Virtual Machines provide complete control over the operating system and installed software. You can install any web server, any programming language runtime, any libraries or tools you need. This flexibility is essential for legacy applications, applications with OS-level dependencies, or scenarios requiring specific configurations not available in App Service. However, this control comes with management overhead. You're responsible for OS patching, security updates, configuring redundancy, and handling failures.

App Service is Platform as a Service offering that handles infrastructure management for you. You deploy your application code, and Azure manages the OS, runtime updates, scaling, and availability. Built-in features include deployment slots for staging, automatic scaling based on metrics, easy SSL certificate management, and integration with Azure DevOps for CI/CD. The trade-off is less control. You're limited to supported runtimes and configurations.

The exam presents scenarios with requirements that indicate which service to recommend. Look for phrases like "legacy application requiring specific OS configuration" or "need to install custom drivers" pointing toward VMs. Conversely, "want to focus on application code rather than infrastructure" or "need automatic scaling without managing load balancers" suggests App Service.

Cost considerations differ between the approaches. VMs charge for allocated resources regardless of utilization. App Service can scale down to zero instances during idle periods on consumption plans, or provides better density on app service plans by running multiple apps on shared infrastructure. The exam might ask about cost optimization where App Service consumption plans provide better cost control for variable workloads.

Scaling differs significantly between the options. VMs require you to create multiple instances, configure load balancing, handle session management, and implement health monitoring. App Service provides built-in scaling with automatic instance management, integrated load balancing, and configurable autoscale rules based on metrics. Exam scenarios requiring "automatic scaling with minimal configuration" indicate App Service.

Migration paths from VMs to App Service exist for modernizing applications. You might start on VMs for compatibility, then refactor to work on App Service for better manageability. The exam might present modernization scenarios where understanding both options helps plan migration strategies.

## Exam Study Points

Several key concepts about web servers on VMs deserve special attention for the AZ-204 exam. Public IP addresses with dynamic versus static allocation determine whether IPs persist through deallocation. Dynamic IPs are lost on deallocate but work fine with DNS names. Static IPs persist but cost more. Know when each is appropriate.

DNS names with Azure-provided FQDN format provide consistent access regardless of IP changes. The cloudapp.azure.com domain with your chosen name and region provides automatic DNS updates. Custom domains require configuring DNS records with external registrars.

Network Security Groups with inbound rules control access to web servers. Default configuration denies inbound internet traffic. You must explicitly allow traffic on ports eighty and four hundred forty-three for web servers. NSG rules have priority, source, destination, port, protocol, and action.

VM state management with stopped versus deallocated states affects billing. Stopped VMs continue most charges. Deallocated VMs stop compute charges but retain storage costs. Scheduled shutdown helps control costs for non-production workloads.

Installing software through SSH demonstrates post-deployment configuration. Package managers like apt-get install software. Testing with curl verifies functionality before opening network access. Custom script extensions automate software installation.

Choosing between VMs and App Service requires evaluating control versus management overhead. VMs provide OS-level control but require more management. App Service simplifies operations but limits configuration. Look for clues in exam scenarios about legacy applications, specific OS needs, or preferences for managed services.

Security best practices include using SSH keys rather than passwords for authentication, opening only required ports in NSG rules, keeping software patched and updated, using custom domains with SSL certificates for production, and implementing monitoring to detect issues.

The exam tests practical application through scenarios describing web hosting requirements and asking you to recommend solutions or troubleshoot problems. Understanding not just how to configure web servers on VMs but when VMs are appropriate versus other options is what demonstrates comprehensive knowledge.

## Cleanup

When you're finished with web server exercises, deallocate or delete VMs to stop compute charges. Deleting the resource group removes all resources including the VM, disks, public IPs, NSG, and virtual network. Using az group delete with the yes and no-wait flags removes everything efficiently. Understanding cleanup procedures demonstrates cost management practices that the exam values. Remember that deallocated VMs retain disks and static IPs which continue to cost money, while deleted VMs eliminate all charges except for any separately managed resources.
