# Azure Container Registry - AZ-204 Exam Focus

## Exam Relevance

Azure Container Registry (ACR) is an important topic for the AZ-204: Developing Solutions for Microsoft Azure exam. It falls under the "Implement containerized solutions" objective, which typically accounts for 15-20% of the exam.

## Key Exam Objectives

For the AZ-204 exam, you should be able to:

1. **Create and manage container registries**
   - Create an ACR instance using Azure CLI or Portal
   - Understand SKU differences (Basic, Standard, Premium)
   - Choose appropriate SKU based on requirements

2. **Build and store container images**
   - Build Docker images locally and push to ACR
   - Use ACR Tasks to build images in Azure
   - Tag images appropriately with versioning strategies

3. **Authenticate to ACR**
   - Use Azure CLI authentication for development
   - Configure service principals for CI/CD pipelines
   - Understand admin account usage and limitations
   - Use managed identities for Azure services

4. **Manage images and repositories**
   - Pull images from ACR
   - Delete images and tags
   - Understand image retention policies

5. **Integrate ACR with Azure services**
   - Deploy containers from ACR to Azure Container Instances
   - Use ACR with Azure Kubernetes Service
   - Configure webhooks for automation

## Critical Concepts for the Exam

### 1. Registry Naming and Access

**Registry DNS Structure:**
- Registry name: `<registry-name>`
- Login server: `<registry-name>.azurecr.io`
- Full image name: `<registry-name>.azurecr.io/<repository>:<tag>`

**Naming Rules:**
- Globally unique across Azure
- 5-50 characters
- Lowercase letters and numbers only
- No hyphens or special characters

### 2. SKU Feature Comparison

| Feature | Basic | Standard | Premium |
|---------|-------|----------|---------|
| Storage | 10 GB | 100 GB | 500 GB |
| Webhook support | Yes | Yes | Yes |
| Geo-replication | No | No | Yes |
| Private Link | No | No | Yes |
| Customer-managed keys | No | No | Yes |
| Use case | Dev/test | Production | Enterprise |

**Exam Tip:** Know when to recommend Premium SKU - geo-replication and private endpoints are the key differentiators.

### 3. Authentication Methods

**Individual Azure AD Identity:**
```bash
az acr login -n <registry-name>
```
- Best for: Development scenarios
- Duration: Temporary (3-hour token)
- Requires: Azure CLI and active Azure login

**Service Principal:**
```bash
docker login <registry-name>.azurecr.io -u <service-principal-id> -p <service-principal-password>
```
- Best for: CI/CD pipelines, automation
- Duration: Long-lived credentials
- Requires: Creating service principal with ACR permissions

**Admin Account:**
```bash
# Enable admin account
az acr update -n <registry-name> --admin-enabled true

# Get credentials
az acr credential show -n <registry-name>
```
- Best for: Quick testing only
- Not recommended: Production use
- Note: Disabled by default for security

**Managed Identity:**
- Best for: Azure services (ACI, AKS, App Service)
- No credentials: Service authenticates automatically
- Most secure: No secrets to manage

**Exam Tip:** You should recommend managed identities over service principals when the compute service supports it.

### 4. Common CLI Commands

**Creating a Registry:**
```bash
az acr create -g <resource-group> -n <registry-name> --sku <Basic|Standard|Premium> -l <location>
```

**Logging In:**
```bash
az acr login -n <registry-name>
```

**Pushing an Image:**
```bash
# Tag the image
docker tag <source-image> <registry-name>.azurecr.io/<repository>:<tag>

# Push to ACR
docker push <registry-name>.azurecr.io/<repository>:<tag>
```

**Building with ACR Tasks:**
```bash
az acr build -t <registry-name>.azurecr.io/<repository>:<tag> -r <registry-name> <source-location>
```

**Listing Repositories:**
```bash
az acr repository list -n <registry-name>
```

**Listing Tags:**
```bash
az acr repository show-tags -n <registry-name> --repository <repository-name>
```

**Deleting Images:**
```bash
# Delete a specific tag
az acr repository delete -n <registry-name> --image <repository>:<tag>

# Delete entire repository
az acr repository delete -n <registry-name> --repository <repository-name>
```

### 5. ACR Tasks (Important for Exam)

ACR Tasks allow you to build images in Azure without requiring Docker on your local machine:

**Quick Task (One-time build):**
```bash
az acr build -t <registry-name>.azurecr.io/myapp:v1 -r <registry-name> .
```

**Automated Builds:**
ACR Tasks can automatically build images when:
- Code is committed to Git
- Base images are updated
- On a schedule

**Multi-step Tasks:**
Define complex workflows with multiple build and push operations.

**Exam Tip:** Know that ACR Tasks can build images without Docker installed locally - this is often a scenario-based question.

### 6. Geo-Replication (Premium SKU)

**Purpose:**
- Reduce latency for global deployments
- Maintain single registry name across regions
- Improve reliability with regional redundancy

**How it Works:**
- Create replicas in multiple Azure regions
- Same registry name across all regions
- Images automatically synchronized
- Pull from nearest replica automatically

**Configuration:**
```bash
az acr replication create -r <registry-name> -l <region>
```

**Exam Tip:** Geo-replication is a Premium-only feature and requires understanding when it's cost-effective.

### 7. Integration Scenarios

**Azure Container Instances (ACI):**
```bash
# Using admin credentials (not recommended for production)
az container create -g <resource-group> -n <container-name> \
  --image <registry-name>.azurecr.io/<repository>:<tag> \
  --registry-username <username> \
  --registry-password <password>

# Using managed identity (recommended)
az container create -g <resource-group> -n <container-name> \
  --image <registry-name>.azurecr.io/<repository>:<tag> \
  --assign-identity \
  --acr-identity <identity-id>
```

**Azure Kubernetes Service (AKS):**
```bash
# Attach ACR to AKS cluster
az aks update -n <cluster-name> -g <resource-group> --attach-acr <registry-name>
```

**Exam Tip:** Know how to deploy from ACR to both ACI and AKS, including authentication methods.

### 8. Security Considerations

**Content Trust:**
- Sign images to verify authenticity
- Prevent deployment of unsigned images
- Premium SKU feature

**Private Endpoints:**
- Restrict access to virtual networks
- Disable public access entirely
- Premium SKU feature

**Firewall Rules:**
- Restrict access by IP address
- Configure network rules
- Available in all SKUs

**Exam Tip:** Be able to recommend appropriate security features based on compliance requirements.

## Common Exam Scenarios

### Scenario 1: CI/CD Pipeline Authentication

**Question Type:** "Your company needs to authenticate a Jenkins CI/CD pipeline to push images to ACR. What should you use?"

**Answer:** Service Principal
- Create service principal with AcrPush role
- Store credentials in Jenkins credential store
- Use in docker login command

**Why not other options:**
- Individual identity: Tied to user account, not suitable for automation
- Admin account: Less secure, no granular permissions
- Managed identity: Only works for Azure services, not external tools

### Scenario 2: Global Deployment

**Question Type:** "Your application is deployed in 5 Azure regions globally. Users report slow image pull times. How can you improve performance?"

**Answer:** Enable geo-replication (requires Premium SKU)
- Replicate registry to regions where app is deployed
- Each region pulls from nearest replica
- Reduces latency and data transfer costs

### Scenario 3: Cost Optimization

**Question Type:** "Your ACR storage costs are increasing due to old images. How can you manage this?"

**Answer:** Implement image retention policy or cleanup script
- Use retention policies to auto-delete old images (Premium SKU)
- Create scheduled script using `az acr repository delete`
- Keep only N most recent tags per repository

### Scenario 4: Secure Access

**Question Type:** "Your company requires that ACR is not accessible from the public internet. What should you configure?"

**Answer:** Private Link/Private Endpoint (requires Premium SKU)
- Create private endpoint in your VNet
- Disable public network access
- Access registry only through private IP

## Practice Commands Checklist

Make sure you can execute these commands without referring to documentation:

- [ ] Create an ACR instance
- [ ] Log in to ACR using Azure CLI
- [ ] Tag an image for ACR
- [ ] Push an image to ACR
- [ ] Pull an image from ACR
- [ ] List all repositories in ACR
- [ ] List all tags for a repository
- [ ] Build an image using ACR Tasks
- [ ] Delete a specific image tag
- [ ] Enable admin account on ACR
- [ ] Get admin credentials
- [ ] Create a service principal for ACR
- [ ] Deploy to ACI from ACR
- [ ] Attach ACR to AKS cluster

## Key Takeaways for the Exam

1. **Understand SKU differences** - Know when Basic/Standard/Premium is appropriate
2. **Master authentication** - Different methods for different scenarios
3. **Know ACR Tasks** - Building without local Docker is a common scenario
4. **Integration is key** - ACR is rarely used alone; know ACI and AKS integration
5. **Security matters** - Private endpoints, managed identities, service principals
6. **Cost management** - Image retention and cleanup strategies
7. **Global deployment** - Geo-replication for multi-region scenarios

## Additional Study Resources

- Practice creating registries in different SKUs and comparing features
- Build a complete CI/CD pipeline that uses ACR
- Deploy applications from ACR to both ACI and AKS
- Implement different authentication methods
- Configure webhooks and observe their behavior
- Practice the lab cleanup scenario - it demonstrates real-world ACR management

Remember: The exam tests practical application, not just theory. Make sure you've hands-on experience with all major ACR operations.
