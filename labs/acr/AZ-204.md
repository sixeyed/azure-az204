# Azure Container Registry - AZ-204 Exam Exercises

**AZ-204 Exam Domain:** Implement containerized solutions (10-15%)

This lab extends the basic Azure Container Registry exercises with specific scenarios and skills required for the AZ-204 exam.

## Prerequisites

Complete the basic [ACR lab](README.md) first to understand fundamental container registry operations.

## AZ-204 Exam Skills Covered

- Understand ACR service tiers and features
- Build container images using ACR Tasks
- Implement geo-replication for global distribution
- Configure webhooks for CI/CD integration
- Enable and use content trust for image signing
- Implement vulnerability scanning
- Integrate ACR with Container Apps, ACI, and AKS

## Exercise 1: ACR Service Tiers

**AZ-204 Critical Topic:** Understand the differences between Basic, Standard, and Premium tiers.

### Service Tier Comparison

| Feature | Basic | Standard | Premium |
|---------|-------|----------|---------|
| **Storage** | 10 GB | 100 GB | 500 GB |
| **Throughput** | Low | Medium | High |
| **Webhooks** | 2 | 10 | 500 |
| **Geo-replication** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Content Trust** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Private Link** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Availability Zones** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **VNet Integration** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Customer-managed Keys** | ‚ùå No | ‚ùå No | ‚úÖ Yes |
| **Pricing** | $ | $$ | $$$ |

### Create ACR with Different Tiers

```bash
az group create -n labs-acr-az204 --tags courselabs=azure -l eastus

# Basic tier (development)
az acr create \
  -g labs-acr-az204 \
  -n acrbasic$RANDOM \
  --sku Basic \
  --admin-enabled true

# Standard tier (production)
az acr create \
  -g labs-acr-az204 \
  -n acrstd$RANDOM \
  --sku Standard \
  --admin-enabled false

# Premium tier (enterprise)
ACR_NAME=acrprem$RANDOM
az acr create \
  -g labs-acr-az204 \
  -n $ACR_NAME \
  --sku Premium \
  --admin-enabled false
```

### Upgrade ACR Tier

```bash
# Upgrade from Basic to Standard
az acr update \
  -n acrbasic<suffix> \
  --sku Standard

# Upgrade from Standard to Premium
az acr update \
  -n acrstd<suffix> \
  --sku Premium
```

üìã Check the features available in your Premium registry.

<details>
  <summary>Not sure how?</summary>

```bash
az acr show \
  -n $ACR_NAME \
  --query '{name:name, sku:sku.name, loginServer:loginServer, adminEnabled:adminUserEnabled, publicNetworkAccess:publicNetworkAccess}' \
  -o table
```

</details><br/>

> **AZ-204 Exam Tip:**
> - **Basic**: Development, testing, low-throughput scenarios
> - **Standard**: Production workloads without geo-replication
> - **Premium**: Enterprise features (geo-replication, content trust, private endpoints)
> - You can upgrade tiers but cannot downgrade
> - Premium is required for geo-replication and private endpoints

## Exercise 2: Build Images with ACR Tasks

**AZ-204 Critical Topic:** Build container images in Azure without Docker locally.

### Quick Build (One-Time)

```bash
# Create a simple application
mkdir webapp
cat > webapp/Dockerfile << 'EOF'
FROM nginx:alpine
COPY index.html /usr/share/nginx/html/
RUN echo "Build timestamp: $(date)" >> /usr/share/nginx/html/index.html
EOF

cat > webapp/index.html << 'EOF'
<!DOCTYPE html>
<html>
<head><title>ACR Build Demo</title></head>
<body>
  <h1>Built with ACR Tasks!</h1>
  <p>This image was built in Azure Container Registry.</p>
</body>
</html>
EOF

# Build image using ACR Tasks
az acr build \
  -t webapp:v1 \
  -r $ACR_NAME \
  ./webapp

# Build with build arguments
az acr build \
  -t webapp:v2 \
  -r $ACR_NAME \
  --build-arg VERSION=2.0 \
  --build-arg ENV=production \
  ./webapp
```

### Automated Build Task (CI/CD)

Create a task that builds on every git push:

```bash
# Create a task that builds from GitHub repo
az acr task create \
  -n webapp-build-task \
  -r $ACR_NAME \
  --context https://github.com/Azure-Samples/acr-build-helloworld-node.git \
  --file Dockerfile \
  --git-access-token <PAT_TOKEN> \
  --image webapp-auto:{{.Run.ID}} \
  --commit-trigger-enabled true
```

### Multi-Step Tasks with YAML

Create a task file for multi-step builds:

```bash
cat > acr-task.yaml << 'EOF'
version: v1.1.0
steps:
  # Build the application image
  - build: -t {{.Run.Registry}}/webapp:{{.Run.ID}} -f Dockerfile .

  # Run tests on the image
  - cmd: {{.Run.Registry}}/webapp:{{.Run.ID}}
    args: ['/bin/sh', '-c', 'echo Testing application...']

  # Tag as latest if tests pass
  - cmd: docker tag {{.Run.Registry}}/webapp:{{.Run.ID}} {{.Run.Registry}}/webapp:latest

  # Push both tags
  - push:
    - {{.Run.Registry}}/webapp:{{.Run.ID}}
    - {{.Run.Registry}}/webapp:latest
EOF

# Create task from YAML
az acr task create \
  -n multi-step-build \
  -r $ACR_NAME \
  -f acr-task.yaml \
  --context https://github.com/yourrepo/app.git \
  --git-access-token <PAT_TOKEN>
```

### Schedule Tasks

```bash
# Create a task that runs on a schedule (nightly build)
az acr task create \
  -n nightly-build \
  -r $ACR_NAME \
  --context https://github.com/yourrepo/app.git \
  --file Dockerfile \
  --image webapp-nightly:{{.Run.Date}} \
  --schedule "0 2 * * *"
```

### Run Task Manually

```bash
# Run an existing task manually
az acr task run \
  -n webapp-build-task \
  -r $ACR_NAME

# Run with overrides
az acr task run \
  -n webapp-build-task \
  -r $ACR_NAME \
  --set VERSION=3.0
```

üìã Create a task that builds an image and runs tests before pushing.

<details>
  <summary>Not sure how?</summary>

```bash
cat > build-and-test.yaml << 'EOF'
version: v1.1.0
steps:
  - id: build-app
    build: -t {{.Run.Registry}}/myapp:{{.Run.ID}} .

  - id: run-tests
    cmd: {{.Run.Registry}}/myapp:{{.Run.ID}}
    args: ['npm', 'test']

  - id: tag-latest
    when: ['run-tests']
    cmd: docker tag {{.Run.Registry}}/myapp:{{.Run.ID}} {{.Run.Registry}}/myapp:latest

  - id: push-images
    push:
      - {{.Run.Registry}}/myapp:{{.Run.ID}}
      - {{.Run.Registry}}/myapp:latest
EOF

az acr task create \
  -n build-test-push \
  -r $ACR_NAME \
  -f build-and-test.yaml \
  --context .
```

</details><br/>

> **AZ-204 Exam Tip:**
> - ACR Tasks builds images in cloud (no local Docker required)
> - **Quick build**: `az acr build` for one-time builds
> - **Task**: Automated builds triggered by code commits, base image updates, or schedule
> - **Multi-step tasks**: Complex CI/CD workflows with testing and deployment
> - Tasks can be triggered by: Git commits, base image updates, timers, manual runs

## Exercise 3: Geo-Replication

**AZ-204 Premium Feature:** Replicate registry across multiple Azure regions.

### Understanding Geo-Replication

Benefits:
- **Low latency**: Pull images from nearest region
- **High availability**: Redundancy across regions
- **Network egress**: Reduce cross-region data transfer costs
- **Single registry**: Manage one registry with multiple replicas

### Enable Geo-Replication

```bash
# Ensure you have Premium tier
az acr update -n $ACR_NAME --sku Premium

# Add replication to West US
az acr replication create \
  -r $ACR_NAME \
  -l westus

# Add replication to Europe
az acr replication create \
  -r $ACR_NAME \
  -l westeurope

# Add replication to Asia
az acr replication create \
  -r $ACR_NAME \
  -l southeastasia
```

### List Replications

```bash
az acr replication list \
  -r $ACR_NAME \
  -o table
```

### Verify Geo-Replication

```bash
# Push an image
echo "FROM nginx:alpine" > Dockerfile
az acr build -t geo-test:v1 -r $ACR_NAME .

# Check replication status
az acr replication show \
  -r $ACR_NAME \
  -l westeurope \
  --query '{location:location, provisioningState:provisioningState, status:status}' \
  -o table
```

### Pull from Regional Endpoint

```bash
# Pull from nearest replica (automatic)
docker pull ${ACR_NAME}.azurecr.io/geo-test:v1

# Pull from specific region (optional)
docker pull ${ACR_NAME}.westeurope.data.azurecr.io/geo-test:v1
```

üìã Add replication to two additional regions and verify images are replicated.

<details>
  <summary>Not sure how?</summary>

```bash
# Add more replicas
az acr replication create -r $ACR_NAME -l eastasia
az acr replication create -r $ACR_NAME -l northeurope

# List all replications
az acr replication list -r $ACR_NAME -o table

# Check if image exists in all regions
az acr repository show-tags \
  -n $ACR_NAME \
  --repository geo-test \
  -o table
```

Each replica contains all images and tags automatically.

</details><br/>

> **AZ-204 Exam Tip:**
> - Geo-replication requires **Premium tier**
> - Single management endpoint for all replicas
> - Images pushed once, replicated automatically
> - Pulls always from nearest region
> - Each replica billed separately
> - Cannot delete home region (must delete registry)

## Exercise 4: Webhooks for CI/CD Integration

**AZ-204 Topic:** Trigger actions when images are pushed or deleted.

### Create a Webhook

```bash
# Create webhook for push events
az acr webhook create \
  -r $ACR_NAME \
  -n myAppWebhook \
  --uri https://myapp.azurewebsites.net/api/webhook \
  --actions push \
  --scope webapp:*

# Create webhook for both push and delete
az acr webhook create \
  -r $ACR_NAME \
  -n cicdWebhook \
  --uri https://your-ci-system.com/webhook \
  --actions push delete \
  --scope '*' \
  --headers Authorization="Bearer token123"
```

### Configure Webhook with Specific Scope

```bash
# Webhook for specific repository
az acr webhook create \
  -r $ACR_NAME \
  -n prodWebhook \
  --uri https://prod-deploy.com/webhook \
  --actions push \
  --scope production/*:latest

# Webhook for specific tags
az acr webhook create \
  -r $ACR_NAME \
  -n releaseWebhook \
  --uri https://release-manager.com/webhook \
  --actions push \
  --scope '*:v*'
```

### Test Webhook

```bash
# Trigger a webhook ping
az acr webhook ping \
  -r $ACR_NAME \
  -n myAppWebhook

# List recent webhook events
az acr webhook list-events \
  -r $ACR_NAME \
  -n myAppWebhook \
  -o table
```

### Update Webhook

```bash
# Update webhook URI
az acr webhook update \
  -r $ACR_NAME \
  -n myAppWebhook \
  --uri https://new-endpoint.com/webhook

# Enable/disable webhook
az acr webhook update \
  -r $ACR_NAME \
  -n myAppWebhook \
  --status disabled
```

üìã Create a webhook that triggers only when images with 'production' tag are pushed.

<details>
  <summary>Not sure how?</summary>

```bash
az acr webhook create \
  -r $ACR_NAME \
  -n productionWebhook \
  --uri https://production-deploy.example.com/webhook \
  --actions push \
  --scope '*:production' \
  --headers Authorization="Bearer secrettoken" \
         X-Environment="production"

# Test it
az acr build -t myapp:production -r $ACR_NAME .

# Check webhook fired
az acr webhook list-events \
  -r $ACR_NAME \
  -n productionWebhook \
  -o table
```

</details><br/>

> **AZ-204 Exam Tip:**
> - Webhooks POST HTTP/HTTPS to specified URI
> - **Actions**: push, delete, quarantine, chart_push, chart_delete
> - **Scope**: Filter by repository and/or tag pattern
> - **Headers**: Add custom authentication headers
> - **Status codes**: 2xx = success, others = retry with backoff
> - Use for: CI/CD pipelines, deployment automation, notifications

## Exercise 5: Content Trust (Image Signing)

**AZ-204 Premium Feature:** Ensure image integrity and publisher authenticity.

### Enable Content Trust

```bash
# Enable content trust on registry
az acr config content-trust update \
  -r $ACR_NAME \
  --status enabled

# Verify content trust is enabled
az acr config content-trust show -r $ACR_NAME
```

### Docker Content Trust (DCT)

```bash
# Login to ACR
az acr login -n $ACR_NAME

# Enable Docker Content Trust locally
export DOCKER_CONTENT_TRUST=1

# Set notary server
export DOCKER_CONTENT_TRUST_SERVER=https://${ACR_NAME}.azurecr.io

# Push signed image
docker tag nginx:alpine ${ACR_NAME}.azurecr.io/signed-app:v1
docker push ${ACR_NAME}.azurecr.io/signed-app:v1

# You'll be prompted to create root key and repository key
```

### Pull Signed Images

```bash
# With content trust enabled
export DOCKER_CONTENT_TRUST=1
docker pull ${ACR_NAME}.azurecr.io/signed-app:v1

# Try to pull unsigned image (will fail)
docker pull ${ACR_NAME}.azurecr.io/unsigned-app:v1
# Error: remote trust data does not exist
```

### Manage Trust Keys

```bash
# View trusted images
docker trust inspect ${ACR_NAME}.azurecr.io/signed-app:v1

# Revoke trust
docker trust revoke ${ACR_NAME}.azurecr.io/signed-app:v1

# View trust metadata
az acr repository show \
  -n $ACR_NAME \
  --repository signed-app \
  --query '{trust:trust}'
```

üìã Sign an image and verify the signature can be validated.

<details>
  <summary>Not sure how?</summary>

```bash
# Enable content trust
export DOCKER_CONTENT_TRUST=1
export DOCKER_CONTENT_TRUST_SERVER=https://${ACR_NAME}.azurecr.io

# Build and sign
docker build -t ${ACR_NAME}.azurecr.io/secure-app:v1 .
docker push ${ACR_NAME}.azurecr.io/secure-app:v1

# Enter passphrases for root key and repository key when prompted

# Verify signature
docker trust inspect --pretty ${ACR_NAME}.azurecr.io/secure-app:v1

# Pull and verify (will fail if signature invalid)
docker pull ${ACR_NAME}.azurecr.io/secure-app:v1
```

</details><br/>

> **AZ-204 Exam Tip:**
> - Content trust requires **Premium tier**
> - Based on Docker Content Trust (DCT) and Notary
> - **Root key**: Controls repository keys (keep offline)
> - **Repository key**: Signs images for specific repo
> - Prevents: Unsigned images, tampered images, man-in-the-middle attacks
> - Use with: Admission controllers in Kubernetes for policy enforcement

## Exercise 6: Vulnerability Scanning

**AZ-204 Topic:** Scan images for security vulnerabilities.

### Enable Microsoft Defender for Containers

```bash
# Enable Microsoft Defender for container registries
az security pricing create \
  -n ContainerRegistry \
  --tier standard

# Check security status
az security pricing show -n ContainerRegistry
```

### View Vulnerability Scan Results

```bash
# Push an image to trigger scan
az acr build -t vulnerable-app:v1 -r $ACR_NAME .

# Wait for scan to complete (usually 1-2 minutes)
# View scan results via Azure Portal or Security Center

# Check vulnerability assessment
az security assessment list \
  --query "[?contains(name, 'container')].{Name:displayName, Status:status.code}" \
  -o table
```

### Scan Specific Image

```bash
# Trigger scan for specific image (using Azure Security Center)
# Results available in Azure Portal > Security Center > Recommendations

# View image metadata including scan timestamp
az acr repository show \
  -n $ACR_NAME \
  --repository vulnerable-app \
  --query '{name:name, lastUpdateTime:lastUpdateTime}'
```

### Quarantine Vulnerable Images

```bash
# Set quarantine policy (Premium feature)
az acr config content-trust update \
  -r $ACR_NAME \
  --status enabled

# Quarantine specific image
az acr repository update \
  -n $ACR_NAME \
  --repository vulnerable-app \
  --write-enabled false

# Try to pull (will fail if quarantined)
docker pull ${ACR_NAME}.azurecr.io/vulnerable-app:v1
```

üìã Configure a policy to block images with critical vulnerabilities.

<details>
  <summary>Not sure how?</summary>

```bash
# Enable Defender for Containers
az security pricing create -n ContainerRegistry --tier standard

# In Azure Portal:
# 1. Go to Security Center > Regulatory Compliance
# 2. Enable "Container registries should have vulnerability findings resolved"
# 3. Set up quarantine for vulnerable images

# Alternatively, use ACR Tasks with scanning
cat > scan-task.yaml << 'EOF'
version: v1.1.0
steps:
  - cmd: mcr.microsoft.com/azure-cli
    args: ['az', 'acr', 'task', 'run', '--registry', '{{.Run.Registry}}']
EOF

# Note: Full vulnerability blocking requires integration with
# admission controllers in AKS or Container Apps
```

</details><br/>

> **AZ-204 Exam Tip:**
> - **Microsoft Defender for Containers**: Automatic vulnerability scanning
> - Scans images on push and periodically
> - Identifies: CVEs, malware, exposed secrets
> - **Severity levels**: Critical, High, Medium, Low
> - **Quarantine**: Prevents pulling vulnerable images
> - Integration with Azure Security Center for centralized management

## Exercise 7: Integration with Azure Services

**AZ-204 Critical:** Use ACR with ACI, Container Apps, and AKS.

### Integration with Azure Container Instances (ACI)

```bash
# Method 1: Admin credentials (development)
ACR_USERNAME=$(az acr credential show -n $ACR_NAME --query username -o tsv)
ACR_PASSWORD=$(az acr credential show -n $ACR_NAME --query 'passwords[0].value' -o tsv)
ACR_SERVER=$(az acr show -n $ACR_NAME --query loginServer -o tsv)

az container create \
  -g labs-acr-az204 \
  -n app-from-acr \
  --image ${ACR_SERVER}/webapp:v1 \
  --registry-login-server $ACR_SERVER \
  --registry-username $ACR_USERNAME \
  --registry-password $ACR_PASSWORD \
  --ports 80

# Method 2: Managed Identity (production - RECOMMENDED)
az container create \
  -g labs-acr-az204 \
  -n app-from-acr-mi \
  --image ${ACR_SERVER}/webapp:v1 \
  --assign-identity \
  --ports 80

# Grant AcrPull role to managed identity
IDENTITY=$(az container show -g labs-acr-az204 -n app-from-acr-mi --query identity.principalId -o tsv)
ACR_ID=$(az acr show -n $ACR_NAME --query id -o tsv)

az role assignment create \
  --assignee $IDENTITY \
  --role AcrPull \
  --scope $ACR_ID
```

### Integration with Azure Container Apps

```bash
# Create Container App Environment
az containerapp env create \
  -g labs-acr-az204 \
  -n myenv \
  -l eastus

# Create Container App with ACR image
az containerapp create \
  -g labs-acr-az204 \
  -n myapp \
  --image ${ACR_SERVER}/webapp:v1 \
  --environment myenv \
  --registry-server $ACR_SERVER \
  --registry-username $ACR_USERNAME \
  --registry-password $ACR_PASSWORD \
  --target-port 80 \
  --ingress external

# Update Container App when new image pushed
az containerapp update \
  -g labs-acr-az204 \
  -n myapp \
  --image ${ACR_SERVER}/webapp:v2
```

### Integration with Azure Kubernetes Service (AKS)

```bash
# Create AKS cluster with ACR integration
az aks create \
  -g labs-acr-az204 \
  -n myaks \
  --attach-acr $ACR_NAME \
  --node-count 2 \
  --generate-ssh-keys

# Verify ACR integration
az aks check-acr \
  -g labs-acr-az204 \
  -n myaks \
  --acr ${ACR_NAME}.azurecr.io

# Deploy to AKS from ACR
kubectl create deployment webapp --image=${ACR_SERVER}/webapp:v1
kubectl expose deployment webapp --port=80 --type=LoadBalancer

# Attach ACR to existing AKS
az aks update \
  -g labs-acr-az204 \
  -n existing-aks \
  --attach-acr $ACR_NAME
```

### Service Principal Authentication

```bash
# Create service principal for ACR
ACR_ID=$(az acr show -n $ACR_NAME --query id -o tsv)

SP_PASSWD=$(az ad sp create-for-rbac \
  --name http://${ACR_NAME}-pull \
  --scopes $ACR_ID \
  --role acrpull \
  --query password -o tsv)

SP_APP_ID=$(az ad sp list \
  --display-name http://${ACR_NAME}-pull \
  --query '[0].appId' -o tsv)

# Use SP credentials in deployments
az container create \
  -g labs-acr-az204 \
  -n app-sp-auth \
  --image ${ACR_SERVER}/webapp:v1 \
  --registry-login-server $ACR_SERVER \
  --registry-username $SP_APP_ID \
  --registry-password $SP_PASSWD \
  --ports 80
```

üìã Set up AKS to automatically pull images from ACR using managed identity.

<details>
  <summary>Not sure how?</summary>

```bash
# Method 1: During AKS creation
az aks create \
  -g labs-acr-az204 \
  -n myaks-mi \
  --attach-acr $ACR_NAME \
  --enable-managed-identity \
  --node-count 1

# Method 2: Attach to existing AKS
az aks update \
  -g labs-acr-az204 \
  -n existing-aks \
  --attach-acr $ACR_NAME

# Method 3: Manual role assignment
AKS_IDENTITY=$(az aks show -g labs-acr-az204 -n myaks --query identityProfile.kubeletidentity.clientId -o tsv)
ACR_ID=$(az acr show -n $ACR_NAME --query id -o tsv)

az role assignment create \
  --assignee $AKS_IDENTITY \
  --role AcrPull \
  --scope $ACR_ID

# Verify
az aks check-acr -g labs-acr-az204 -n myaks --acr ${ACR_NAME}.azurecr.io
```

</details><br/>

> **AZ-204 Exam Tip:** Authentication methods (best to worst):
> 1. **Managed Identity**: No credentials, automatic token refresh (BEST)
> 2. **Service Principal**: For automation, can be rotated
> 3. **Admin Account**: Simple but less secure, use only for dev/test
>
> For AKS: Use `--attach-acr` for automatic integration
> For ACI: Use `--assign-identity` with AcrPull role
> For Container Apps: Supports all authentication methods

## AZ-204 Exam Study Points

### Key Concepts to Master

1. **ACR Tiers:**
   - **Basic**: 10GB, dev/test, no geo-replication
   - **Standard**: 100GB, production, no geo-replication
   - **Premium**: 500GB, geo-replication, content trust, private links
   - Can upgrade but not downgrade tiers

2. **ACR Tasks:**
   - **Quick build**: `az acr build` for one-time builds
   - **Task**: Automated builds on triggers
   - **Triggers**: Git commit, base image update, schedule, manual
   - **Multi-step**: Complex workflows with testing

3. **Geo-Replication (Premium only):**
   - Replicate to multiple Azure regions
   - Automatic synchronization of images
   - Reduce latency and network egress costs
   - Single registry management

4. **Webhooks:**
   - Trigger on push, delete, quarantine events
   - Filter by repository and tag scope
   - Add custom headers for authentication
   - Limited by tier (Basic: 2, Standard: 10, Premium: 500)

5. **Content Trust (Premium only):**
   - Docker Content Trust (DCT) integration
   - Image signing and verification
   - Root key and repository keys
   - Prevents unsigned/tampered images

6. **Vulnerability Scanning:**
   - Microsoft Defender for Containers
   - Automatic scan on push
   - CVE detection and severity classification
   - Quarantine vulnerable images

7. **Authentication Methods:**
   - Managed Identity (best for Azure services)
   - Service Principal (for automation)
   - Admin account (dev/test only)
   - Azure AD user (individual access)
   - Scoped tokens (limited permissions)

### Common Exam Scenarios

1. **Scenario:** Build container images without Docker installed locally
   - **Solution:** Use `az acr build` or ACR Tasks

2. **Scenario:** Automatically rebuild image when base image updates
   - **Solution:** Create ACR Task with base image trigger

3. **Scenario:** Deploy images globally with low latency
   - **Solution:** Enable geo-replication (Premium tier required)

4. **Scenario:** Trigger deployment when new image pushed
   - **Solution:** Configure webhook to call deployment API

5. **Scenario:** Ensure only signed images are deployed
   - **Solution:** Enable content trust (Premium tier)

6. **Scenario:** Grant AKS pull access without credentials
   - **Solution:** Use `az aks create --attach-acr` with managed identity

7. **Scenario:** Scan images for security vulnerabilities
   - **Solution:** Enable Microsoft Defender for Containers

### Best Practices

1. **Security:**
   - Disable admin account in production
   - Use managed identities for Azure services
   - Enable content trust for critical workloads
   - Implement vulnerability scanning
   - Use private endpoints (Premium)

2. **Performance:**
   - Use geo-replication for global apps
   - Choose appropriate tier for workload
   - Use caching proxies for frequently pulled images
   - Monitor registry metrics

3. **Cost Optimization:**
   - Right-size tier based on storage needs
   - Delete unused images and tags
   - Use retention policies
   - Monitor and optimize geo-replicas

4. **CI/CD Integration:**
   - Use ACR Tasks for automated builds
   - Configure webhooks for deployment automation
   - Implement multi-stage builds
   - Tag images with git commit SHA

5. **Operations:**
   - Enable diagnostic logging
   - Monitor with Azure Monitor
   - Implement image retention policies
   - Use tags effectively (version, environment)

## Cleanup

```bash
az group delete -y -n labs-acr-az204 --no-wait
```

## Additional Resources

- [Azure Container Registry documentation](https://docs.microsoft.com/en-us/azure/container-registry/)
- [ACR Tasks documentation](https://docs.microsoft.com/en-us/azure/container-registry/container-registry-tasks-overview)
- [Geo-replication in ACR](https://docs.microsoft.com/en-us/azure/container-registry/container-registry-geo-replication)
- [Content trust in ACR](https://docs.microsoft.com/en-us/azure/container-registry/container-registry-content-trust)
- [Authenticate with ACR](https://docs.microsoft.com/en-us/azure/container-registry/container-registry-authentication)
- [AZ-204 Study Guide](https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-204)
